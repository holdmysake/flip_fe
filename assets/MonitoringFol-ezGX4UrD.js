import{u as ve}from"./theme-CXy-lvFx.js";import{d as $e,i as fe}from"./index-B5d4h4Xc.js";import{_ as Oe}from"./MainWrapperView.vue_vue_type_style_index_0_lang-BxTxsdkc.js";import{_ as ne}from"./InputView.vue_vue_type_style_index_0_lang-DR5YG-0X.js";import{_ as de}from"./SelectView.vue_vue_type_style_index_0_lang-BNcgRLru.js";import{_ as X}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-BWzzh-Oz.js";import{d as ce,c as O,k as le,e,f as ie,u as R,a as o,r as ye,n as ae,t as Y,q as Ne,o as T,l as te,w as _,g as a,i as F,h as ke,j as ge,_ as Se,F as ue,v as Te,x as Ce,b as we,y as me,z as Fe}from"./index-D3c2G3Za.js";import{u as he}from"./http-DghsseS_.js";import{t as _e}from"./trunk-dwr8fwI0.js";import{_ as Ve}from"./BatteryView.vue_vue_type_style_index_0_computed_true_lang-B46HF8cg.js";import{p as De}from"./api-BClSR59j.js";import{h as Pe}from"./moment-C5S46NFB.js";import{l as Ue}from"./index-TjCxX7sJ.js";const qe={key:0,class:"mod-overlay"},Re={class:"mod-heading"},ze={class:"mod-body"},xe=ce({__name:"ModalEditorView",props:{modTitle:{type:String,required:!0},modShow:{type:Boolean,default:!0}},emits:["update:modShow"],setup(j,{emit:U}){const w=ve(),y=j,x=U,p=()=>{x("update:modShow",!y.modShow)};return(V,I)=>{const u=ye("font-awesome-icon");return j.modShow?(T(),O("div",qe,[e("div",{class:ae(["mod-content",R(w).mTheme])},[e("button",{onClick:p,type:"button",class:"mod-dismiss",style:ie({color:R(w).accentColor})},[o(u,{icon:"times"})],4),e("div",Re,[e("h4",{class:ae(R(w).textTheme)},[e("b",null,Y(j.modTitle),1)],2)]),e("div",ze,[Ne(V.$slots,"default")])],2)])):le("",!0)}}}),Ge={class:"itemlist-wrapper"},Be={class:"itemlist-group"},je=ce({__name:"ItemList",props:{itemName:{type:String,required:!0},itemDesc:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemSafemark:{type:Number,default:0,required:!0}},emits:["onItemSelect"],setup(j,{emit:U}){const w=ve(),y=U,x=j,p=()=>{y("onItemSelect",{id:x.itemId,name:x.itemName,desc:x.itemDesc})};return(V,I)=>{const u=ye("font-awesome-icon");return T(),O("div",Ge,[e("div",Be,[e("span",{style:ie({color:R(w).accentColor})},[e("b",null,Y(j.itemName),1)],4),e("span",{style:ie({color:R(w).accentColor})},[o(u,{icon:"map-pin"}),te(" "+Y(j.itemDesc),1)],4)]),o(X,{onClick:p,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(u,{icon:"plus"})]),_:1})])}}}),He={class:"chart-containers"},Ee={class:"col-md-4"},We={class:"loaderparent"},Xe=ce({__name:"LiveMonitorChart",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(j){const U=j,w=a(!0),y=a(null),x=a(null),p=ve(),V=a(15),I=a([]),u=a(0),m=a("Building chart..."),A=a("Initializing..."),g=a(0),P=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),l=C=>new Date(C).toISOString(),z=async()=>new Promise(async(C,$)=>{await he().httpGet("api/Spot/getspots").then(r=>{C(r)}).catch(r=>{console.error(r),$(r)})});F(()=>y.value,async()=>{S(),await z().then(C=>{I.value=C})});const S=()=>{if(u.value=5,y.value){const C=fe(y.value);x.value=C,x.value.setOption(P.value)}},H=async()=>new Promise(async(C,$)=>{try{const r=[],s=new Set,k=I.value.length;let v=0;A.value="Setting up...";for(let D=0;D<I.value.length;D++){A.value=`Applying filter for ${I.value[D].spotName}...`;const K={id:I.value[D].id+"",date:l(U.dateFilter),timespan:U.timeFilter+"",firstrequest:w.value},N=await he().httpPost("api/Data/getsingledata",K);for(let W=0;W<N.length;W++)setTimeout(()=>{g.value++},1);const f=N.map(W=>{const Q=W.timestamp.replace(".",":").split("T")[1],[Z,oe]=Q.split(":"),re=`${Z}:${oe}`;return s.add(re),re}),M=N.map(W=>parseFloat(W.psiValue));r.push({psies:M,categories:f}),v+=1;const L=v/k*90;u.value=Math.round(L)}const G=Array.from(s).sort((D,K)=>{const[N,f]=D.split(":").map(Number),[M,L]=K.split(":").map(Number);return N!==M?N-M:f-L}),J=r.map((D,K)=>{const N={};D.categories.forEach((M,L)=>{N[M]=D.psies[L]});const f=G.map(M=>N[M]!==void 0?parseFloat(N[M]):null);return{name:`${I.value[K].spotName}`,type:"line",data:f,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:1},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(M){let L=0;const W=r[M.seriesIndex].psies.length;for(let q=0;q<W;q++)r[M.seriesIndex].psies[q]!==null&&(L=r[M.seriesIndex].psies[q].toFixed(2));return L}}}}),E={backgroundColor:"transparent",legend:{data:J.map(D=>({name:D.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:G,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(D){return D.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${p.accentColor}`,rotate:-45,interval:D=>{const[K,N]=G[D].split(":").map(Number);return N%V.value===0},formatter:function(D){return D}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:J};C(E)}catch(r){console.error(r),$(r)}});return F(()=>I.value,async()=>{await H().then(C=>{x.value.setOption(C),A.value="Drawing series...",u.value=99.99,setTimeout(()=>{u.value=100,g.value=0},2e3)})}),F(()=>V.value,async()=>{u.value=5,A.value="Setting up...",m.value="Options & filter updated. Rebuilding chart with new series...",x.value&&(x.value=null),S(),setTimeout(async()=>{await H().then(C=>{x.value.setOption(C),u.value=99.99,A.value="Drawing series...",setTimeout(()=>{u.value=100,g.value=0},2e3)})},1e3)}),ke(()=>{S()}),ge(()=>{y.value&&$e(y.value)}),(C,$)=>(T(),O("div",He,[e("h3",{style:{padding:"15px"},class:ae([`${R(p).textTheme}`])},$[1]||($[1]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Ee,[o(de,{"in-label":"X-Axis Time Split","model-value":V.value,"onUpdate:modelValue":$[0]||($[0]=r=>V.value=r)},{default:_(()=>$[2]||($[2]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:y,style:{width:"100%",position:"relative",height:"90%"}},null,512),u.value!=100?(T(),O("div",{key:0,class:ae(["chartloader",[`${R(p).mTheme}`]])},[$[3]||($[3]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:ae([`${R(p).textTheme}`])},Y(m.value)+" ("+Y(g.value)+" objects collected)",3),e("span",{style:ie({color:`${R(p).accentColorSecondary}`})},Y(A.value),5),e("div",We,[e("span",{style:ie({width:`${u.value}%`,background:`${R(p).accentColor}`}),class:"loaderinner"},null,4)])],2)):le("",!0)]))}}),Ye=Se(Xe,[["__scopeId","data-v-69f62916"]]),Je={class:"chart-containers"},Ke={class:"col-md-4"},Qe={class:"loaderparent"},Ze=ce({__name:"LiveMonitorSegmentView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(j){const U=_e(),w=j,y=a(!0),x=a(null),p=a(null),V=ve(),I=a(15),u=a([]),m=a(0),A=a("Building chart..."),g=a("Initializing..."),P=a(0),l=a("trunk1"),z=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),S=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),H=s=>new Date(s).toISOString(),C=()=>{u.value=U.getTrunk(l.value).spot};F(()=>x.value,()=>{$(),C()});const $=()=>{if(m.value=5,x.value){const s=fe(x.value);p.value=s,p.value.setOption(z.value)}},r=async()=>new Promise(async(s,k)=>{try{const v=[],G=new Set,J=u.value.length;let E=0;g.value="Setting up...";for(let f=0;f<u.value.length;f++){g.value=`Applying filter for ${u.value[f].spotName}...`;const M={id:u.value[f].id+"",date:H(w.dateFilter),timespan:w.timeFilter+"",firstrequest:y.value},L=await he().httpPost("api/Data/getsingledata",M);for(let Z=0;Z<L.length;Z++)setTimeout(()=>{P.value++},1);const W=L.map(Z=>{const re=Z.timestamp.replace(".",":").split("T")[1],[pe,c]=re.split(":"),i=`${pe}:${c}`;return G.add(i),i}),q=L.map(Z=>parseFloat(Z.psiValue));v.push({psies:q,categories:W}),E+=1;const Q=E/J*90;m.value=Math.round(Q)}const D=Array.from(G).sort((f,M)=>{const[L,W]=f.split(":").map(Number),[q,Q]=M.split(":").map(Number);return L!==q?L-q:W-Q}),K=v.map((f,M)=>{const L={};f.categories.forEach((q,Q)=>{L[q]=f.psies[Q]});const W=D.map(q=>L[q]!==void 0?parseFloat(L[q]):null);return{name:`${u.value[M].spotName}`,type:"line",data:W,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:2},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(q){let Q=0;const Z=v[q.seriesIndex].psies.length;for(let oe=0;oe<Z;oe++)v[q.seriesIndex].psies[oe]!==null&&(Q=v[q.seriesIndex].psies[oe].toFixed(2));return Q}}}}),N={backgroundColor:"transparent",legend:{data:K.map(f=>({name:f.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:D,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(f){return f.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${V.accentColor}`,rotate:-45,interval:f=>{const[M,L]=D[f].split(":").map(Number);return L%I.value===0},formatter:function(f){return f}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:K};s(N)}catch(v){console.error(v),k(v)}});return F(()=>u.value,async()=>{await r().then(s=>{p.value.setOption(s),g.value="Drawing series...",m.value=99.99,setTimeout(()=>{m.value=100,P.value=0},2e3)})}),F(()=>I.value,async()=>{m.value=5,g.value="Setting up...",A.value="Options & filter updated. Rebuilding chart with new series...",p.value&&(p.value=null),$(),setTimeout(async()=>{await r().then(s=>{p.value.setOption(s),m.value=99.99,g.value="Drawing series...",setTimeout(()=>{m.value=100,P.value=0},2e3)})},1e3)}),ke(()=>{$()}),ge(()=>{x.value&&$e(x.value)}),F(()=>l.value,()=>{u.value=U.getTrunk(l.value).spot,p.value.clear(),p.value.setOption(S),$()}),(s,k)=>(T(),O("div",Je,[e("h3",{style:{padding:"15px"},class:ae([`${R(V).textTheme}`])},k[2]||(k[2]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Ke,[o(de,{"in-label":"Select Spot","model-value":l.value,"onUpdate:modelValue":k[0]||(k[0]=v=>l.value=v)},{default:_(()=>k[3]||(k[3]=[e("option",{value:"trunk1"},"MGS BJG - BOOSTER",-1),e("option",{value:"trunk2"},"MGS KAS - MOS SPPP",-1),e("option",{value:"trunk3"},"SGL LINE",-1),e("option",{value:"trunk4"},"BETUNG - BAJUBANG",-1)])),_:1},8,["model-value"]),o(de,{"in-label":"X-Axis Time Split","model-value":I.value,"onUpdate:modelValue":k[1]||(k[1]=v=>I.value=v)},{default:_(()=>k[4]||(k[4]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:x,style:{width:"100%",position:"relative",height:"100%"}},null,512),m.value!=100?(T(),O("div",{key:0,class:ae(["chartloader",[`${R(V).mTheme}`]])},[k[5]||(k[5]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:ae([`${R(V).textTheme}`])},Y(A.value)+" ("+Y(P.value)+" objects collected)",3),e("span",{style:ie({color:`${R(V).accentColorSecondary}`})},Y(g.value),5),e("div",Qe,[e("span",{style:ie({width:`${m.value}%`,background:`${R(V).accentColor}`}),class:"loaderinner"},null,4)])],2)):le("",!0)]))}}),et=Se(Ze,[["__scopeId","data-v-40464d3f"]]),tt=async j=>(await De("/fe/getAllSpots",j,!0)).data,lt=async j=>(await De("/fe/getDataBySpot",j,!0)).data,at={style:{display:"flex","flex-flow":"column","margin-bottom":"1rem"}},ot=["id"],st={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end",gap:"0.5rem","margin-bottom":"1.5rem"}},nt={contenteditable:"true",spellcheck:"false"},it=ce({__name:"ChartView2",props:{filterDate:{type:String,required:!0},filterTime:{type:Number,required:!0},spotId:{type:String,required:!0},chartName:{type:String,required:!0},yMax:{type:Number,required:!0,default:350},yMin:{type:Number,required:!0,default:0},gridview:{type:Boolean,default:!1},tickAmount:{type:Number,default:100},dataFetchInterval:{type:Number,default:1e4},curveType:{type:Boolean,default:!1},safeMark:{type:Number,default:0},isDataPaused:Boolean,showUis:{type:Boolean,default:!0},yInterval:{type:Number,default:0},livePoint:{type:Object,required:!1}},emits:["onChartClose","onChartReady","onPause","onResume","onDrawingMode"],setup(j,{emit:U}){const w=a([]),y=a([]),x=U,p=ve(),V=a(!1),I=a(!0),u=a(null),m=a(null),A=a(!1),g=a(!1);let P;const l=j,z=a(l.safeMark),S=a(!1),H=a(l.yMax),C=a(l.yMin),$=a(l.tickAmount),r=a(50),s=a(l.dataFetchInterval),k=a(l.curveType),v=a(!0),G=a(!0);function J(c,i){return{tooltip:{show:!0,trigger:"item",axisPointer:{type:"cross",axis:"auto",label:{show:!0}}},xAxis:[{type:"category",interval:$.value,axisLine:{show:!0,lineStyle:{color:p.accentColor}},splitLine:{show:G,lineStyle:{color:"#ddd",type:"dashed"}},axisTick:{show:!0},boundaryGap:!1,axisLabel:{rotate:45},data:[]}],yAxis:[{type:"value",min:0,max:c,minorTick:{show:!0},axisTick:{show:!0},minorSplitLine:{show:v,lineStyle:{color:"#ddd",type:"dashed"}},interval:l.yInterval,axisLine:{show:!0,lineStyle:{color:p.accentColor}}}],series:[{name:"PSI Data",type:"line",symbol:"none",data:[],smooth:l.curveType,lineStyle:{width:1.2,join:"miter",miterLimit:3,cap:"round"},tooltip:{position:["50%","50%"]},endLabel:{show:!0,distance:0,color:"black",backgroundColor:"white",padding:5,borderRadius:5}},{name:"Safe Mark",type:"line",tooltip:{trigger:"item"},lineStyle:{color:"red",type:"solid"},markLine:{symbol:"none",label:{show:!1},lineStyle:{color:"red",type:"dashed"},data:[{yAxis:z.value}]}}]}}F(()=>z.value,()=>{var c;E.value.series[1].markLine.data[0].yAxis=z.value,(c=m.value)==null||c.setOption(E.value)});const E=a(J(l.yMax,l.curveType));F(()=>[H.value,C.value,$.value,s.value,k.value,r.value,v.value,G.value],()=>{m.value.setOption(E.value)});const D=()=>{var c;!m.value&&u.value&&(m.value=fe(u.value)),(c=m.value)==null||c.setOption(E.value)},K=c=>new Date(c).toISOString(),N=async()=>{var c;try{const i=typeof K=="function"?K(l.filterDate):new Date(l.filterDate).toISOString(),B=await lt({field_id:"jbi",spot_id:l.spotId,timestamp:i}),b=Array.isArray(B==null?void 0:B.data)?B.data:Array.isArray(B)?B:[],se=b.map(t=>{const h=String(t.timestamp??""),n=h.replace(".",":");if(n.includes("T")){const Ie=n.split("T")[1]||"",[Ae="00",Le="00"]=Ie.split(":");return`${Ae}:${Le}`}const ee=new Date(h||i),be=String(ee.getHours()).padStart(2,"0"),Me=String(ee.getMinutes()).padStart(2,"0");return`${be}:${Me}`}),d=b.map(t=>{const h=Number(t.psiValue??t.psi??t.value);return isFinite(h)?h:NaN}).map(t=>Number(isFinite(t)?t.toFixed(2):"NaN"));w.value=se,y.value=d,d.length&&d.some(t=>isFinite(t))?(A.value=!1,E.value.xAxis[0].data=se,E.value.series[0].data=d,(c=m.value)==null||c.setOption(E.value)):(A.value=!0,I.value=!1)}catch(i){console.error(i)}},f=()=>{const c=new Date().toISOString().slice(0,10);if(l.filterDate.slice(0,10)!==c){P&&clearInterval(P);return}else P&&clearInterval(P),P=setInterval(()=>{g.value||N()},s.value)};F(()=>u.value,()=>{u.value&&D()}),F(()=>l.gridview,()=>{m.value&&setTimeout(()=>{var c;(c=m.value)==null||c.resize()},500)}),F(()=>l.dataFetchInterval,()=>{s.value=l.dataFetchInterval,f()}),F(()=>[u.value],()=>{N(),f()}),ge(()=>{clearInterval(P)});let M=null;F(()=>[l.filterDate,l.filterTime,l.yMax,l.yMin,l.tickAmount,l.curveType],()=>{M&&clearTimeout(M),M=setTimeout(()=>{H.value=l.yMax,C.value=l.yMin,$.value=l.tickAmount,k.value=l.curveType,s.value=l.dataFetchInterval,E.value=J(l.yMax,l.curveType),I.value=!0,V.value=!1},300)});let L=null;F(()=>[H.value,C.value,$.value,s.value,k.value],()=>{L&&clearTimeout(L),L=setTimeout(()=>{N()},500)}),p.$subscribe((c,i)=>{setTimeout(()=>{N()},2e3)});const W=()=>{x("onChartClose",l.spotId)},q=()=>{S.value=!S.value},Q=()=>{S.value=!1},Z=()=>{g.value=!g.value,g.value?x("onPause",l.spotId):x("onResume",l.spotId)};F(()=>[l.isDataPaused],()=>{g.value=l.isDataPaused,g.value?x("onPause",l.spotId):x("onResume",l.spotId)}),F(()=>g.value,()=>{g.value?x("onPause",l.spotId):x("onResume",l.spotId)}),F(()=>p.asideVisible,()=>{m.value&&setTimeout(()=>{var c;(c=m.value)==null||c.resize()},500)});const oe=()=>{x("onDrawingMode",l.spotId)},re=c=>{const i=c.includes("T")?c:c.replace(" ","T"),B=new Date(i),b=String(B.getHours()).padStart(2,"0"),se=String(B.getMinutes()).padStart(2,"0");return`${b}:${se}`},pe=c=>{if(!w.value.length)return!0;const i=w.value[w.value.length-1],B=new Date((l.filterDate+" "+i).replace(" ","T"));return new Date(c.includes("T")?c:c.replace(" ","T")).getTime()>B.getTime()};return F(()=>l.livePoint,c=>{var b;if(!c||g.value)return;const i=Number(c.val);if(!Number.isFinite(i))return;const B=re(c.ts);if(w.value.length&&w.value[w.value.length-1]===B)y.value[y.value.length-1]=Number(i.toFixed(2));else{if(!pe(c.ts))return;w.value.push(B),y.value.push(Number(i.toFixed(2)))}A.value=!1,E.value.xAxis[0].data=w.value,E.value.series[0].data=y.value,(b=m.value)==null||b.setOption({xAxis:[{data:w.value}],series:[{data:y.value},{}]})}),(c,i)=>{const B=ye("font-awesome-icon");return T(),O(ue,null,[o(xe,{"mod-show":S.value,"onUpdate:modShow":i[9]||(i[9]=b=>S.value=b),"mod-title":`${l.chartName} Preferences`},{default:_(()=>[o(ne,{"in-type":"number","in-label":"Safemark","model-value":z.value,"onUpdate:modelValue":i[0]||(i[0]=b=>z.value=b)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Max Tick","model-value":H.value,"onUpdate:modelValue":i[1]||(i[1]=b=>H.value=b)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Min Tick","model-value":C.value,"onUpdate:modelValue":i[2]||(i[2]=b=>C.value=b)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Interval","model-value":r.value,"onUpdate:modelValue":i[3]||(i[3]=b=>r.value=b)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"X-Axis Tick Amount","model-value":$.value,"onUpdate:modelValue":i[4]||(i[4]=b=>$.value=b)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Data Update Interval (Milisecond)","model-value":s.value,"onUpdate:modelValue":i[5]||(i[5]=b=>s.value=b)},null,8,["model-value"]),o(de,{"in-label":"Curve Type","model-value":k.value,"onUpdate:modelValue":i[6]||(i[6]=b=>k.value=b)},{default:_(()=>i[10]||(i[10]=[e("option",{value:"true"},"Smooth",-1),e("option",{value:"false"},"Straight",-1)])),_:1},8,["model-value"]),e("div",at,[e("label",null,[Te(e("input",{type:"checkbox","onUpdate:modelValue":i[7]||(i[7]=b=>v.value=b)},null,512),[[Ce,v.value]]),i[11]||(i[11]=te(" Show Y-Axis Minor Split "))]),e("label",null,[Te(e("input",{type:"checkbox","onUpdate:modelValue":i[8]||(i[8]=b=>G.value=b)},null,512),[[Ce,G.value]]),i[12]||(i[12]=te(" Show X-Axis Split "))])]),o(X,{onClick:Q,"bt-type":"button","bt-disabled":!1},{default:_(()=>i[13]||(i[13]=[te("Dismiss")])),_:1})]),_:1},8,["mod-show","mod-title"]),e("div",{id:`chart${l.spotId}`,style:ie({width:l.gridview?R(p).asideVisible?"680px":"600.5px":"100%"}),class:ae(["chartwrap",g.value?"chartwrap-paused":""])},[l.showUis?(T(),O("div",st,[o(X,{onClick:oe,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(B,{icon:"edit"})]),_:1}),o(X,{onClick:Z,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(B,{icon:g.value?"pause":"play"},null,8,["icon"])]),_:1}),y.value.length?(T(),we(X,{key:0,onClick:q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(B,{icon:"sliders"})]),_:1})):le("",!0),o(X,{onClick:W,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(B,{icon:"close"})]),_:1})])):le("",!0),o(Ve,{"id-spot":parseInt(l.spotId)},null,8,["id-spot"]),e("h4",{style:ie({textAlign:"center",color:R(p).accentColor})},[e("b",nt,"SPOT: "+Y(l.chartName),1)],4),y.value.length?(T(),O("p",{key:1,style:{"text-align":"center","margin-bottom":"5px"},class:ae(R(p).textTheme)}," Displaying data for last "+Y(l.filterTime)+" hour(s) on "+Y(l.filterDate),3)):le("",!0),e("div",{ref_key:"chartRef",ref:u,style:{width:"100%",height:"600px"}},null,512)],14,ot)],64)}}}),rt={class:"cl-filter"},ut={key:0,class:"trunk-selector"},dt={style:{width:"500px",display:"flex",padding:"15px","flex-flow":"column"}},ct=["value"],vt={style:{width:"500px",display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem",position:"relative"}},pt={style:{display:"flex","flex-flow":"column","align-items":"center"}},mt={style:{display:"flex","flex-flow":"row wrap","justify-content":"center"}},ft=["onClick"],yt=ce({__name:"ChartLayerView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(j){const U=a(null),w=a(null),y=a(_e().getAllTrunk()),x=r=>new Date(r).toISOString(),p=j,V=a(p.dateFilter),I=a("15"),u=a({legend:{show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",name:"Time",data:[],nameGap:40,boundaryGap:0,nameLocation:"center",axisLabel:{show:!0,rotate:45,interval:r=>l.value[r]===void 0?!1:l.value[r].split(":")[1]%I.value===0},axisSplitLine:{show:!0,lineStyle:{type:"solid"}},axisLine:{show:!0,lineStyle:{type:"solid"}}},yAxis:{type:"value",min:0,max:550,interval:50,minorTick:{show:!0},scale:!0,nameLocation:"center",nameGap:50,boundaryGap:0,splitLine:{show:!0,lineStyle:{type:"solid",color:"#00000055"}},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#00000022"}},axisTick:{show:!0},name:"Pressure (PSI)",axisLine:{show:!0}},series:[]});F(()=>I.value,()=>{u.value.xAxis.axisLabel.interval=r=>l.value[r].split(":")[1]%I.value===0,g()}),F(()=>V.value,()=>{Object.keys(m.value).length>0&&H()});const m=a({}),A=a(),g=()=>{w.value.setOption(u.value)};F(()=>U.value,()=>{w.value=fe(U.value),g()});const P=a({}),l=a([]),z=a(!1),S=()=>{const r=A.value,s=y.value[r].name,k=y.value[r].spot;m.value[s]=k,z.value=!1,P.value={},l.value=[],w.value.clear(),u.value.series=[],w.value.setOption(u.value),H()},H=()=>{Object.keys(m.value).forEach(async r=>{const s=[],k=[];for(let v=0;v<m.value[r].length;v++){const J={id:m.value[r][v].id+"",date:x(V.value),timespan:p.timeFilter+"",firstrequest:!0},D=await he().httpPost("api/Data/getsingledata",J),K=D.map(f=>f.psiValue.toFixed(2));k.push({type:"line",data:K,smooth:!1,symbol:"none",name:m.value[r][v].name});const N=D.map(f=>Pe(f.timestamp).format("HH:mm"));for(let f=0;f<N.length;f++)s.includes(N[f])||s.push(N[f])}P.value[r]=k,l.value=s})};F(()=>P,()=>{w.value.clear(),w.value.setOption(u.value),C()},{deep:!0});const C=()=>{u.value.xAxis.data=l.value,Object.keys(P.value).forEach(r=>{for(let s=0;s<P.value[r].length;s++)u.value.series.push(P.value[r][s])}),w.value.setOption(u.value)},$=r=>{delete m.value[r],H()};return(r,s)=>{const k=ye("font-awesome-icon");return T(),O(ue,null,[e("div",rt,[z.value?(T(),O("div",ut,[e("button",{onClick:s[0]||(s[0]=v=>z.value=!z.value),type:"button",class:"drwclose"},[o(k,{icon:"close"})]),e("div",dt,[s[7]||(s[7]=e("h5",null,[e("b",null,"Trunkline Preference")],-1)),o(de,{"in-label":"Trunkline",style:{width:"100%"},"model-value":A.value,"onUpdate:modelValue":s[1]||(s[1]=v=>A.value=v)},{default:_(()=>[s[5]||(s[5]=e("option",{selected:"",value:""},"Select Trunkline...",-1)),(T(!0),O(ue,null,me(y.value,(v,G)=>(T(),O("option",{key:G,value:G},Y(v.name),9,ct))),128))]),_:1},8,["model-value"]),o(X,{onClick:S,"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content",padding:"13px",width:"170px"}},{default:_(()=>s[6]||(s[6]=[te("Load into Chart")])),_:1})])])):le("",!0),s[9]||(s[9]=e("h3",null,[e("b",null,"Chart Layer")],-1)),e("div",vt,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":V.value,"onUpdate:modelValue":s[2]||(s[2]=v=>V.value=v)},null,8,["model-value"]),o(de,{"in-label":"X-Axis Gap",style:{width:"100%"},"model-value":I.value,"onUpdate:modelValue":s[3]||(s[3]=v=>I.value=v)},{default:_(()=>s[8]||(s[8]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),o(X,{onClick:s[4]||(s[4]=v=>z.value=!z.value),"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content","margin-top":"36px",padding:"13px"}},{default:_(()=>[o(k,{icon:"plus"})]),_:1})])]),e("div",{ref_key:"chart",ref:U,style:{width:"100%",height:"480px"}},null,512),s[11]||(s[11]=e("hr",null,null,-1)),e("div",pt,[s[10]||(s[10]=e("label",null,[e("b",null,"Active Trunklines")],-1)),e("div",mt,[(T(!0),O(ue,null,me(m.value,(v,G)=>(T(),O("span",{class:"active-trunklines",key:G,onClick:J=>$(G),style:{margin:"5px"}},[e("span",null,Y(G),1)],8,ft))),128))])])],64)}}}),ht=Se(yt,[["__scopeId","data-v-a1bd2a50"]]),gt={key:0,class:"chart-layer"},bt={class:"chart-layer-inner"},wt={key:1,class:"live-window"},xt={key:2,class:"live-window"},kt={key:3,class:"drw-wd"},St={class:"row"},Tt={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Ct={class:"col-md-12"},$t={class:"col-md-12"},_t={style:{display:"flex","flex-flow":"row nowrap",gap:"0.4rem"}},Dt={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Mt={class:"spot-reading-control"},It={class:"spot-basket"},At=["onClick","onDblclick"],Lt={key:0,style:{"margin-top":"1rem",display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Et=ce({__name:"MonitoringFol",setup(j){const U=Ue("https://flipapi.rndkito.com");U.emit("joinField","jbi"),U.on("connect",()=>{console.log("Socket Connected:",U.id)}),U.on("disconnect",()=>{console.log("Disconnected")}),U.on("pressure:new",d=>{if((d==null?void 0:d.field_id)!=="jbi"||A.value)return;const t=Number(d==null?void 0:d.psi);Number.isFinite(t)&&(w[d.spot_id]={ts:String(d.timestamp),val:t})});const w=Fe({}),y=ve();y.asideToggle(!0);const x=a(null),p=a(!1),V=a(350),I=a(0),u=a(30),m=a(3e3),A=a(!1),g=a(""),P=a(!1),l=a(24),z=a(!1),S=a([]),H=a(0),C=()=>{H.value<S.value.length&&setTimeout(()=>{H.value++,C()},100)},$=()=>{const d=new Date,t=d.getFullYear(),h=String(d.getMonth()+1).padStart(2,"0"),n=String(d.getDate()).padStart(2,"0"),ee=`${t}-${h}-${n}`;g.value=ee},r=()=>{document.visibilityState==="visible"?setTimeout(()=>{A.value=!1,y.notifyShow("Resuming data fetch")},3e3):A.value=!0};ke(()=>{G(),$(),C(),document.addEventListener("visibilitychange",r)}),ge(()=>{document.removeEventListener("visibilitychange",r)});const s=()=>{z.value=!0},k=d=>{z.value=!1,S.value.some(h=>h.id===d.id)?y.notifyShowError("Selected spot already displayed"):S.value.push(d)},v=d=>{S.value=S.value.filter(t=>!t[d])},G=async()=>{try{const t=(await tt({field_id:"jbi"})).trunklines.flatMap(h=>h.spots.map(n=>({id:n.spot_id,name:n.spot_name,desc:h.tline_name,safemark:n.safe_mark||0,yMax:n.y_max||500,yInterval:n.y_interval||20})));S.value=t,console.log("spots ",S.value)}catch(d){console.error("Failed to fetch spots:",d)}},J=a(!1),E=()=>{J.value=!J.value},D=()=>{J.value=!1,y.notifyShow("Options has been applied")},K=d=>{const t=document.getElementById("chart"+d);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},N=()=>{p.value=!p.value},f=d=>{S.value=S.value.filter(t=>!t[d])};let M=a([]);const L=d=>{M.value.push({id:d});const t=`spotdata-${d}`,h=document.querySelector(`.${t}`);h?(h.style.background="red",h.style.color="white"):console.warn(`Element dengan class ${t} gak ditemukan bro!`)},W=d=>{const t=`spotdata-${d}`,h=document.querySelector(`.${t}`);h?(h.style.background="#000",h.style.color="#fff"):console.warn(`Element dengan class ${t} gak ditemukan bro!`);const n=M.value.findIndex(ee=>ee.id===d);M.value.splice(n,1)},q=()=>{A.value=!1},Q=()=>{A.value=!0},Z=async d=>{},oe=a(!1),re=d=>{console.log("gg"),A.value=!0,oe.value=!0,S.value.length>0?(console.log("masuk1"),pe()):console.log("tutup")},pe=async d=>{const t=fe(x.value);await Z().then(h=>{const n=h.cats,ee=h.series,be={graphic:[{type:"rect",shape:{x:0,y:0,width:t.getWidth(),height:t.getHeight()},style:{fill:"transparent"}}],backgroundColor:"#fff",tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value",min:0,max:350},series:[{type:"line",data:ee,color:n.map(()=>`${y.accentColor}`)}]};t.setOption(be),t.setOption({yAxis:{name:"Pressure (PSI)"}})})},c=()=>{oe.value=!1},i=a(!1),B=()=>{i.value=!1},b=a(!1),se=a(!1);return F(()=>se.value,()=>{se.value?A.value=!0:A.value=!1}),F(()=>S.value.length,(d,t)=>{d>t&&H.value<d&&(H.value++,setTimeout(C,0))}),(d,t)=>{const h=ye("font-awesome-icon");return T(),O(ue,null,[se.value?(T(),O("div",gt,[e("div",bt,[e("button",{onClick:t[0]||(t[0]=n=>se.value=!se.value),type:"button",class:"drwclose"},[o(h,{icon:"close"})]),o(ht,{"date-filter":g.value,"time-filter":l.value},null,8,["date-filter","time-filter"])])])):le("",!0),b.value?(T(),O("div",wt,[e("div",{class:ae(["live-window-inner",[`${R(y).mTheme}`]])},[e("button",{onClick:t[1]||(t[1]=n=>b.value=!b.value),type:"button",class:"drwclose"},[o(h,{icon:"close"})]),o(et,{"date-filter":g.value,"time-filter":l.value},null,8,["date-filter","time-filter"])],2)])):le("",!0),i.value?(T(),O("div",xt,[e("div",{class:ae(["live-window-inner",[`${R(y).mTheme}`]])},[e("button",{type:"button",class:"drwclose",onClick:B},[o(h,{icon:"close"})]),o(Ye,{"date-filter":g.value,"time-filter":l.value},null,8,["date-filter","time-filter"])],2)])):le("",!0),oe.value?(T(),O("div",kt,[e("div",{class:"drw-inner",style:ie({background:`${R(y).themeDarkColor}`})},[e("button",{onClick:c,type:"button",style:ie({color:`${R(y).accentColor}`}),class:"drwclose"},[o(h,{icon:"close"})],4),e("div",{ref_key:"eCharts",ref:x,style:{width:"100%",height:"100%",position:"relative"}},null,512)],4)])):le("",!0),o(xe,{"mod-show":z.value,"onUpdate:modShow":t[2]||(t[2]=n=>z.value=n),"mod-title":"Select spot"},{default:_(()=>[(T(!0),O(ue,null,me(S.value,(n,ee)=>(T(),we(je,{key:ee,onOnItemSelect:k,"item-id":n.id,"item-name":n.name,"item-desc":n.desc,"item-safemark":n.safemark},null,8,["item-id","item-name","item-desc","item-safemark"]))),128))]),_:1},8,["mod-show"]),o(xe,{"mod-show":J.value,"onUpdate:modShow":t[8]||(t[8]=n=>J.value=n),"mod-title":"Global Chart Preference"},{default:_(()=>[e("p",{style:ie({color:R(y).accentColor})},"These parameters applies to all displayed charts",4),o(ne,{"in-label":"Y-Axis Max Tick Range","in-type":"number","model-value":V.value,"onUpdate:modelValue":t[3]||(t[3]=n=>V.value=n)},null,8,["model-value"]),o(ne,{"in-label":"Y-Axis Min Tick Range","in-type":"number","model-value":I.value,"onUpdate:modelValue":t[4]||(t[4]=n=>I.value=n)},null,8,["model-value"]),o(ne,{"in-label":"X-Axis Tick Amount","in-helper":"Greater value produces denser tick rates while lesser value loosen it but trims certain data in some points of time","in-type":"number","model-value":u.value,"onUpdate:modelValue":t[5]||(t[5]=n=>u.value=n)},null,8,["model-value"]),o(ne,{"in-label":"Data Update Interval (Milisecond)","in-helper":"Higher value increases the delay while lower value decreases it. Warning: Lower value require more resources and may significantly affect client-side performance","in-type":"number","model-value":m.value,"onUpdate:modelValue":t[6]||(t[6]=n=>m.value=n)},null,8,["model-value"]),o(de,{"in-label":"Curve Type","model-value":P.value,"onUpdate:modelValue":t[7]||(t[7]=n=>P.value=n)},{default:_(()=>t[14]||(t[14]=[e("option",{value:!0},"Smooth",-1),e("option",{value:!1},"Straight",-1)])),_:1},8,["model-value"]),o(X,{onClick:D,"bt-type":"button","bt-disabled":!1},{default:_(()=>t[15]||(t[15]=[te("Dismiss")])),_:1})]),_:1},8,["mod-show"]),o(Oe,{"context-title":"Monitoring FOL"},{default:_(()=>[e("div",St,[e("div",Tt,[o(X,{onClick:E,"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(h,{icon:"sliders"}),t[16]||(t[16]=te(" Global Chart Preferences"))]),_:1})]),e("div",Ct,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":g.value,"onUpdate:modelValue":t[9]||(t[9]=n=>g.value=n)},null,8,["model-value"]),o(de,{"in-label":"Time Range Filter","model-value":l.value,"onUpdate:modelValue":t[10]||(t[10]=n=>l.value=n)},{default:_(()=>t[17]||(t[17]=[e("option",{value:"1"},"1 Hour",-1),e("option",{value:"3"},"3 Hours",-1),e("option",{value:"6"},"6 Hours",-1),e("option",{value:"12"},"12 Hours",-1),e("option",{value:"24"},"24 Hours",-1)])),_:1},8,["model-value"]),e("div",$t,[e("div",_t,[o(X,{onClick:t[11]||(t[11]=n=>i.value=!i.value),"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(h,{icon:"chart-line"}),t[18]||(t[18]=te(" Live Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[12]||(t[12]=n=>b.value=!b.value),"bt-disabled":!1},{default:_(()=>[o(h,{icon:"chart-line"}),t[19]||(t[19]=te(" Trunkline Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[13]||(t[13]=n=>se.value=!se.value),"bt-disabled":!1},{default:_(()=>[o(h,{icon:"chart-line"}),t[20]||(t[20]=te(" Chart Layer "))]),_:1})])]),e("div",Dt,[o(X,{onClick:s,"bt-type":"button","bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(h,{icon:"add"}),t[21]||(t[21]=te(" Add Chart"))]),_:1})]),e("div",Mt,[o(X,{onClick:q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(h,{icon:"play"}),t[22]||(t[22]=te(" Resume All"))]),_:1}),o(X,{onClick:Q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(h,{icon:"pause"}),t[23]||(t[23]=te(" Pause All"))]),_:1})]),e("div",It,[(T(!0),O(ue,null,me(S.value,n=>(T(),O("span",{key:n.id,class:ae(["spot-data",[`spotdata-${n.id}`]]),onClick:ee=>K(n.id),onDblclick:ee=>v(n.id),title:"Click to navigate to this spot"},Y(n.name)+" ("+Y(n.desc)+") ",43,At))),128))]),S.value.length?(T(),O("div",Lt,[o(X,{onClick:N,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(h,{icon:p.value?"grip-vertical":"expand"},null,8,["icon"]),te(" "+Y(p.value?"Grid chart view":"Full chart view"),1)]),_:1})])):le("",!0),S.value.length>0?(T(),O("div",{key:1,class:ae(p.value?"chart-basket-gridview":"chart-basket-fullview")},[(T(!0),O(ue,null,me(S.value,(n,ee)=>(T(),O("div",{key:n.id,class:"chart-wrapper"},[ee<H.value?(T(),we(it,{key:0,onOnChartReady:C,id:"chart"+n.id,"chart-name":n.name,"filter-date":g.value,"filter-time":l.value,"safe-mark":n.safemark,"spot-id":n.id,"curve-type":P.value,"y-max":n.yMax,"y-min":I.value,"tick-amount":u.value,"y-interval":n.yInterval,"data-fetch-interval":m.value,gridview:p.value,"is-data-paused":A.value,"live-point":w[n.id],onOnDrawingMode:re,onOnChartClose:f,onOnPause:L,onOnResume:W},null,8,["id","chart-name","filter-date","filter-time","safe-mark","spot-id","curve-type","y-max","y-min","tick-amount","y-interval","data-fetch-interval","gridview","is-data-paused","live-point"])):le("",!0)]))),128))],2)):le("",!0)])])]),_:1})],64)}}});export{Et as default};
