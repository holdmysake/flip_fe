import{u as fe}from"./index-BwcIuys3.js";import{d as De,i as ge}from"./index-B5d4h4Xc.js";import{_ as Ne}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DtfXPpAs.js";import{_ as se}from"./InputView.vue_vue_type_style_index_0_lang-v2Wqw3eK.js";import{_ as de}from"./SelectView.vue_vue_type_style_index_0_lang-B8Re_VmC.js";import{_ as E}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-BPsJGFUN.js";import{d as me,c as L,k as ee,e,f as ne,u as q,a,r as be,n as te,t as W,q as Fe,o as $,l as Z,w as _,g as l,i as N,h as Ce,j as xe,_ as $e,F as ue,v as _e,x as Me,b as Se,y as he,z as Ve}from"./index-HIDwiXGh.js";import{u as we}from"./http-hF8QUJF_.js";import{t as Ie}from"./trunk-dwr8fwI0.js";import{_ as Pe}from"./BatteryView.vue_vue_type_style_index_0_computed_true_lang-Dt_BGwDr.js";import{a as Ue,g as qe}from"./folService-BWSQWUVD.js";import{h as Re}from"./moment-C5S46NFB.js";import{l as ze}from"./index-TjCxX7sJ.js";import"./api-BRzHJOd_.js";const Ge={key:0,class:"mod-overlay"},Be={class:"mod-heading"},He={class:"mod-body"},Te=me({__name:"ModalEditorView",props:{modTitle:{type:String,required:!0},modShow:{type:Boolean,default:!0}},emits:["update:modShow"],setup(X,{emit:B}){const M=fe(),F=X,y=B,d=()=>{y("update:modShow",!F.modShow)};return(T,h)=>{const m=be("font-awesome-icon");return X.modShow?($(),L("div",Ge,[e("div",{class:te(["mod-content",q(M).mTheme])},[e("button",{onClick:d,type:"button",class:"mod-dismiss",style:ne({color:q(M).accentColor})},[a(m,{icon:"times"})],4),e("div",Be,[e("h4",{class:te(q(M).textTheme)},[e("b",null,W(X.modTitle),1)],2)]),e("div",He,[Fe(T.$slots,"default")])],2)])):ee("",!0)}}}),je={class:"itemlist-wrapper"},Ee={class:"itemlist-group"},We=me({__name:"ItemList",props:{itemName:{type:String,required:!0},itemDesc:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemSafemark:{type:Number,default:0,required:!0}},emits:["onItemSelect"],setup(X,{emit:B}){const M=fe(),F=B,y=X,d=()=>{F("onItemSelect",{id:y.itemId,name:y.itemName,desc:y.itemDesc})};return(T,h)=>{const m=be("font-awesome-icon");return $(),L("div",je,[e("div",Ee,[e("span",{style:ne({color:q(M).accentColor})},[e("b",null,W(X.itemName),1)],4),e("span",{style:ne({color:q(M).accentColor})},[a(m,{icon:"map-pin"}),Z(" "+W(X.itemDesc),1)],4)]),a(E,{onClick:d,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[a(m,{icon:"plus"})]),_:1})])}}}),Xe={class:"chart-containers"},Ye={class:"col-md-4"},Je={class:"loaderparent"},Ke=me({__name:"LiveMonitorChart",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(X){const B=X,M=l(!0),F=l(null),y=l(null),d=fe(),T=l(15),h=l([]),m=l(0),D=l("Building chart..."),V=l("Initializing..."),C=l(0),I=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),b=c=>new Date(c).toISOString(),Y=async()=>new Promise(async(c,k)=>{await we().httpGet("api/Spot/getspots").then(r=>{c(r)}).catch(r=>{console.error(r),k(r)})});N(()=>F.value,async()=>{o(),await Y().then(c=>{h.value=c})});const o=()=>{if(m.value=5,F.value){const c=ge(F.value);y.value=c,y.value.setOption(I.value)}},j=async()=>new Promise(async(c,k)=>{try{const r=[],s=new Set,S=h.value.length;let p=0;V.value="Setting up...";for(let w=0;w<h.value.length;w++){V.value=`Applying filter for ${h.value[w].spotName}...`;const P={id:h.value[w].id+"",date:b(B.dateFilter),timespan:B.timeFilter+"",firstrequest:M.value},z=await we().httpPost("api/Data/getsingledata",P);for(let G=0;G<z.length;G++)setTimeout(()=>{C.value++},1);const f=z.map(G=>{const K=G.timestamp.replace(".",":").split("T")[1],[Q,ie]=K.split(":"),re=`${Q}:${ie}`;return s.add(re),re}),O=z.map(G=>parseFloat(G.psiValue));r.push({psies:O,categories:f}),p+=1;const A=p/S*90;m.value=Math.round(A)}const R=Array.from(s).sort((w,P)=>{const[z,f]=w.split(":").map(Number),[O,A]=P.split(":").map(Number);return z!==O?z-O:f-A}),J=r.map((w,P)=>{const z={};w.categories.forEach((O,A)=>{z[O]=w.psies[A]});const f=R.map(O=>z[O]!==void 0?parseFloat(z[O]):null);return{name:`${h.value[P].spotName}`,type:"line",data:f,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:1},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(O){let A=0;const G=r[O.seriesIndex].psies.length;for(let U=0;U<G;U++)r[O.seriesIndex].psies[U]!==null&&(A=r[O.seriesIndex].psies[U].toFixed(2));return A}}}}),ae={backgroundColor:"transparent",legend:{data:J.map(w=>({name:w.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:R,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(w){return w.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${d.accentColor}`,rotate:-45,interval:w=>{const[P,z]=R[w].split(":").map(Number);return z%T.value===0},formatter:function(w){return w}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:J};c(ae)}catch(r){console.error(r),k(r)}});return N(()=>h.value,async()=>{await j().then(c=>{y.value.setOption(c),V.value="Drawing series...",m.value=99.99,setTimeout(()=>{m.value=100,C.value=0},2e3)})}),N(()=>T.value,async()=>{m.value=5,V.value="Setting up...",D.value="Options & filter updated. Rebuilding chart with new series...",y.value&&(y.value=null),o(),setTimeout(async()=>{await j().then(c=>{y.value.setOption(c),m.value=99.99,V.value="Drawing series...",setTimeout(()=>{m.value=100,C.value=0},2e3)})},1e3)}),Ce(()=>{o()}),xe(()=>{F.value&&De(F.value)}),(c,k)=>($(),L("div",Xe,[e("h3",{style:{padding:"15px"},class:te([`${q(d).textTheme}`])},k[1]||(k[1]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Ye,[a(de,{"in-label":"X-Axis Time Split","model-value":T.value,"onUpdate:modelValue":k[0]||(k[0]=r=>T.value=r)},{default:_(()=>k[2]||(k[2]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:F,style:{width:"100%",position:"relative",height:"90%"}},null,512),m.value!=100?($(),L("div",{key:0,class:te(["chartloader",[`${q(d).mTheme}`]])},[k[3]||(k[3]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:te([`${q(d).textTheme}`])},W(D.value)+" ("+W(C.value)+" objects collected)",3),e("span",{style:ne({color:`${q(d).accentColorSecondary}`})},W(V.value),5),e("div",Je,[e("span",{style:ne({width:`${m.value}%`,background:`${q(d).accentColor}`}),class:"loaderinner"},null,4)])],2)):ee("",!0)]))}}),Qe=$e(Ke,[["__scopeId","data-v-69f62916"]]),Ze={class:"chart-containers"},et={class:"col-md-4"},tt={class:"loaderparent"},lt=me({__name:"LiveMonitorSegmentView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(X){const B=Ie(),M=X,F=l(!0),y=l(null),d=l(null),T=fe(),h=l(15),m=l([]),D=l(0),V=l("Building chart..."),C=l("Initializing..."),I=l(0),b=l("trunk1"),Y=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),o=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),j=s=>new Date(s).toISOString(),c=()=>{m.value=B.getTrunk(b.value).spot};N(()=>y.value,()=>{k(),c()});const k=()=>{if(D.value=5,y.value){const s=ge(y.value);d.value=s,d.value.setOption(Y.value)}},r=async()=>new Promise(async(s,S)=>{try{const p=[],R=new Set,J=m.value.length;let ae=0;C.value="Setting up...";for(let f=0;f<m.value.length;f++){C.value=`Applying filter for ${m.value[f].spotName}...`;const O={id:m.value[f].id+"",date:j(M.dateFilter),timespan:M.timeFilter+"",firstrequest:F.value},A=await we().httpPost("api/Data/getsingledata",O);for(let Q=0;Q<A.length;Q++)setTimeout(()=>{I.value++},1);const G=A.map(Q=>{const re=Q.timestamp.replace(".",":").split("T")[1],[ce,ye]=re.split(":"),pe=`${ce}:${ye}`;return R.add(pe),pe}),U=A.map(Q=>parseFloat(Q.psiValue));p.push({psies:U,categories:G}),ae+=1;const K=ae/J*90;D.value=Math.round(K)}const w=Array.from(R).sort((f,O)=>{const[A,G]=f.split(":").map(Number),[U,K]=O.split(":").map(Number);return A!==U?A-U:G-K}),P=p.map((f,O)=>{const A={};f.categories.forEach((U,K)=>{A[U]=f.psies[K]});const G=w.map(U=>A[U]!==void 0?parseFloat(A[U]):null);return{name:`${m.value[O].spotName}`,type:"line",data:G,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:2},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(U){let K=0;const Q=p[U.seriesIndex].psies.length;for(let ie=0;ie<Q;ie++)p[U.seriesIndex].psies[ie]!==null&&(K=p[U.seriesIndex].psies[ie].toFixed(2));return K}}}}),z={backgroundColor:"transparent",legend:{data:P.map(f=>({name:f.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:w,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(f){return f.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${T.accentColor}`,rotate:-45,interval:f=>{const[O,A]=w[f].split(":").map(Number);return A%h.value===0},formatter:function(f){return f}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:P};s(z)}catch(p){console.error(p),S(p)}});return N(()=>m.value,async()=>{await r().then(s=>{d.value.setOption(s),C.value="Drawing series...",D.value=99.99,setTimeout(()=>{D.value=100,I.value=0},2e3)})}),N(()=>h.value,async()=>{D.value=5,C.value="Setting up...",V.value="Options & filter updated. Rebuilding chart with new series...",d.value&&(d.value=null),k(),setTimeout(async()=>{await r().then(s=>{d.value.setOption(s),D.value=99.99,C.value="Drawing series...",setTimeout(()=>{D.value=100,I.value=0},2e3)})},1e3)}),Ce(()=>{k()}),xe(()=>{y.value&&De(y.value)}),N(()=>b.value,()=>{m.value=B.getTrunk(b.value).spot,d.value.clear(),d.value.setOption(o),k()}),(s,S)=>($(),L("div",Ze,[e("h3",{style:{padding:"15px"},class:te([`${q(T).textTheme}`])},S[2]||(S[2]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",et,[a(de,{"in-label":"Select Spot","model-value":b.value,"onUpdate:modelValue":S[0]||(S[0]=p=>b.value=p)},{default:_(()=>S[3]||(S[3]=[e("option",{value:"trunk1"},"MGS BJG - BOOSTER",-1),e("option",{value:"trunk2"},"MGS KAS - MOS SPPP",-1),e("option",{value:"trunk3"},"SGL LINE",-1),e("option",{value:"trunk4"},"BETUNG - BAJUBANG",-1)])),_:1},8,["model-value"]),a(de,{"in-label":"X-Axis Time Split","model-value":h.value,"onUpdate:modelValue":S[1]||(S[1]=p=>h.value=p)},{default:_(()=>S[4]||(S[4]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:y,style:{width:"100%",position:"relative",height:"100%"}},null,512),D.value!=100?($(),L("div",{key:0,class:te(["chartloader",[`${q(T).mTheme}`]])},[S[5]||(S[5]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:te([`${q(T).textTheme}`])},W(V.value)+" ("+W(I.value)+" objects collected)",3),e("span",{style:ne({color:`${q(T).accentColorSecondary}`})},W(C.value),5),e("div",tt,[e("span",{style:ne({width:`${D.value}%`,background:`${q(T).accentColor}`}),class:"loaderinner"},null,4)])],2)):ee("",!0)]))}}),at=$e(lt,[["__scopeId","data-v-40464d3f"]]),ot={style:{display:"flex","flex-flow":"column","margin-bottom":"1rem"}},st=["id"],nt={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end",gap:"0.5rem","margin-bottom":"1.5rem"}},it={contenteditable:"true",spellcheck:"false"},rt=me({__name:"ChartView2",props:{filterDate:{type:String,required:!0},filterTime:{type:Number,required:!0},spotId:{type:String,required:!0},chartName:{type:String,required:!0},yMax:{type:Number,required:!0,default:350},yMin:{type:Number,required:!0,default:0},gridview:{type:Boolean,default:!1},tickAmount:{type:Number,default:100},dataFetchInterval:{type:Number,default:1e4},curveType:{type:Boolean,default:!1},safeMark:{type:Number,default:0},isDataPaused:Boolean,showUis:{type:Boolean,default:!0},yInterval:{type:Number,default:0},livePoint:{type:Object,required:!1}},emits:["onChartClose","onChartReady","onPause","onResume","onDrawingMode"],setup(X,{emit:B}){var pe;let M=null;try{const v=localStorage.getItem("user");M=v?JSON.parse(v):null}catch(v){console.error("Failed to parse localStorage user:",v)}const F=((pe=M==null?void 0:M.field)==null?void 0:pe.field_id)||"jbi",y=l([]),d=l([]),T=B,h=fe(),m=l(!1),D=l(!0),V=l(null),C=l(null),I=l(!1),b=l(!1);let Y;const o=X,j=l(o.safeMark),c=l(!1),k=l(o.yMax),r=l(o.yMin),s=l(o.tickAmount),S=l(50),p=l(o.dataFetchInterval),R=l(o.curveType),J=l(!0),ae=l(!0);function w(v,u){return{tooltip:{show:!0,trigger:"item",axisPointer:{type:"cross",axis:"auto",label:{show:!0}}},xAxis:[{type:"category",interval:s.value,axisLine:{show:!0,lineStyle:{color:h.accentColor}},splitLine:{show:ae,lineStyle:{color:"#ddd",type:"dashed"}},axisTick:{show:!0},boundaryGap:!1,axisLabel:{rotate:45},data:[]}],yAxis:[{type:"value",min:0,max:v,minorTick:{show:!0},axisTick:{show:!0},minorSplitLine:{show:J,lineStyle:{color:"#ddd",type:"dashed"}},interval:o.yInterval,axisLine:{show:!0,lineStyle:{color:h.accentColor}}}],series:[{name:"PSI Data",type:"line",symbol:"none",data:[],smooth:o.curveType,lineStyle:{width:1.2,join:"miter",miterLimit:3,cap:"round"},tooltip:{position:["50%","50%"]},endLabel:{show:!0,distance:0,color:"black",backgroundColor:"white",padding:5,borderRadius:5}},{name:"Safe Mark",type:"line",tooltip:{trigger:"item"},lineStyle:{color:"red",type:"solid"},markLine:{symbol:"none",label:{show:!1},lineStyle:{color:"red",type:"dashed"},data:[{yAxis:j.value}]}}]}}N(()=>j.value,()=>{var v;P.value.series[1].markLine.data[0].yAxis=j.value,(v=C.value)==null||v.setOption(P.value)});const P=l(w(o.yMax,o.curveType));N(()=>[k.value,r.value,s.value,p.value,R.value,S.value,J.value,ae.value],()=>{C.value.setOption(P.value)});const z=()=>{var v;!C.value&&V.value&&(C.value=ge(V.value)),(v=C.value)==null||v.setOption(P.value)},f=v=>new Date(v).toISOString(),O=async()=>{var v;try{const u=typeof f=="function"?f(o.filterDate):new Date(o.filterDate).toISOString(),H=await Ue({field_id:F,spot_id:o.spotId,timestamp:u}),g=Array.isArray(H==null?void 0:H.data)?H.data:Array.isArray(H)?H:[],oe=g.map(i=>{const t=String(i.timestamp??""),x=t.replace(".",":");if(x.includes("T")){const Ae=x.split("T")[1]||"",[Le="00",Oe="00"]=Ae.split(":");return`${Le}:${Oe}`}const n=new Date(t||u),le=String(n.getHours()).padStart(2,"0"),ke=String(n.getMinutes()).padStart(2,"0");return`${le}:${ke}`}),ve=g.map(i=>{const t=Number(i.psiValue??i.psi??i.value);return isFinite(t)?t:NaN}).map(i=>Number(isFinite(i)?i.toFixed(2):"NaN"));y.value=oe,d.value=ve,ve.length&&ve.some(i=>isFinite(i))?(I.value=!1,P.value.xAxis[0].data=oe,P.value.series[0].data=ve,(v=C.value)==null||v.setOption(P.value)):(I.value=!0,D.value=!1)}catch(u){console.error(u)}};N(()=>V.value,()=>{V.value&&z()}),N(()=>o.gridview,()=>{C.value&&setTimeout(()=>{var v;(v=C.value)==null||v.resize()},500)}),N(()=>o.dataFetchInterval,()=>{p.value=o.dataFetchInterval}),N(()=>[V.value],()=>{O()}),xe(()=>{clearInterval(Y)});let A=null;N(()=>[o.filterDate,o.filterTime,o.yMax,o.yMin,o.tickAmount,o.curveType],()=>{A&&clearTimeout(A),A=setTimeout(()=>{k.value=o.yMax,r.value=o.yMin,s.value=o.tickAmount,R.value=o.curveType,p.value=o.dataFetchInterval,P.value=w(o.yMax,o.curveType),D.value=!0,m.value=!1},300)});let G=null;N(()=>[k.value,r.value,s.value,p.value,R.value],()=>{G&&clearTimeout(G),G=setTimeout(()=>{O()},500)}),h.$subscribe((v,u)=>{setTimeout(()=>{O()},2e3)});const U=()=>{T("onChartClose",o.spotId)},K=()=>{c.value=!c.value},Q=()=>{c.value=!1},ie=()=>{b.value=!b.value,b.value?T("onPause",o.spotId):T("onResume",o.spotId)};N(()=>[o.isDataPaused],()=>{b.value=o.isDataPaused,b.value?T("onPause",o.spotId):T("onResume",o.spotId)}),N(()=>b.value,()=>{b.value?T("onPause",o.spotId):T("onResume",o.spotId)}),N(()=>h.asideVisible,()=>{C.value&&setTimeout(()=>{var v;(v=C.value)==null||v.resize()},500)});const re=()=>{T("onDrawingMode",o.spotId)},ce=v=>{const u=v.includes("T")?v:v.replace(" ","T"),H=new Date(u),g=String(H.getHours()).padStart(2,"0"),oe=String(H.getMinutes()).padStart(2,"0");return`${g}:${oe}`},ye=v=>{if(!y.value.length)return!0;const u=y.value[y.value.length-1],H=new Date((o.filterDate+" "+u).replace(" ","T"));return new Date(v.includes("T")?v:v.replace(" ","T")).getTime()>H.getTime()};return N(()=>o.livePoint,v=>{var g;if(!v||b.value)return;const u=Number(v.val);if(!Number.isFinite(u))return;const H=ce(v.ts);if(y.value.length&&y.value[y.value.length-1]===H)d.value[d.value.length-1]=Number(u.toFixed(2));else{if(!ye(v.ts))return;y.value.push(H),d.value.push(Number(u.toFixed(2)))}I.value=!1,P.value.xAxis[0].data=y.value,P.value.series[0].data=d.value,(g=C.value)==null||g.setOption({xAxis:[{data:y.value}],series:[{data:d.value},{}]})}),(v,u)=>{const H=be("font-awesome-icon");return $(),L(ue,null,[a(Te,{"mod-show":c.value,"onUpdate:modShow":u[9]||(u[9]=g=>c.value=g),"mod-title":`${o.chartName} Preferences`},{default:_(()=>[a(se,{"in-type":"number","in-label":"Safemark","model-value":j.value,"onUpdate:modelValue":u[0]||(u[0]=g=>j.value=g)},null,8,["model-value"]),a(se,{"in-type":"number","in-label":"Y-Axis Max Tick","model-value":k.value,"onUpdate:modelValue":u[1]||(u[1]=g=>k.value=g)},null,8,["model-value"]),a(se,{"in-type":"number","in-label":"Y-Axis Min Tick","model-value":r.value,"onUpdate:modelValue":u[2]||(u[2]=g=>r.value=g)},null,8,["model-value"]),a(se,{"in-type":"number","in-label":"Y-Axis Interval","model-value":S.value,"onUpdate:modelValue":u[3]||(u[3]=g=>S.value=g)},null,8,["model-value"]),a(se,{"in-type":"number","in-label":"X-Axis Tick Amount","model-value":s.value,"onUpdate:modelValue":u[4]||(u[4]=g=>s.value=g)},null,8,["model-value"]),a(se,{"in-type":"number","in-label":"Data Update Interval (Milisecond)","model-value":p.value,"onUpdate:modelValue":u[5]||(u[5]=g=>p.value=g)},null,8,["model-value"]),a(de,{"in-label":"Curve Type","model-value":R.value,"onUpdate:modelValue":u[6]||(u[6]=g=>R.value=g)},{default:_(()=>u[10]||(u[10]=[e("option",{value:"true"},"Smooth",-1),e("option",{value:"false"},"Straight",-1)])),_:1},8,["model-value"]),e("div",ot,[e("label",null,[_e(e("input",{type:"checkbox","onUpdate:modelValue":u[7]||(u[7]=g=>J.value=g)},null,512),[[Me,J.value]]),u[11]||(u[11]=Z(" Show Y-Axis Minor Split "))]),e("label",null,[_e(e("input",{type:"checkbox","onUpdate:modelValue":u[8]||(u[8]=g=>ae.value=g)},null,512),[[Me,ae.value]]),u[12]||(u[12]=Z(" Show X-Axis Split "))])]),a(E,{onClick:Q,"bt-type":"button","bt-disabled":!1},{default:_(()=>u[13]||(u[13]=[Z("Dismiss")])),_:1})]),_:1},8,["mod-show","mod-title"]),e("div",{id:`chart${o.spotId}`,style:ne({width:o.gridview?q(h).asideVisible?"680px":"600.5px":"100%"}),class:te(["chartwrap",b.value?"chartwrap-paused":""])},[o.showUis?($(),L("div",nt,[a(E,{onClick:re,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[a(H,{icon:"edit"})]),_:1}),a(E,{onClick:ie,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[a(H,{icon:b.value?"pause":"play"},null,8,["icon"])]),_:1}),d.value.length?($(),Se(E,{key:0,onClick:K,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[a(H,{icon:"sliders"})]),_:1})):ee("",!0),a(E,{onClick:U,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[a(H,{icon:"close"})]),_:1})])):ee("",!0),a(Pe,{"id-spot":parseInt(o.spotId)},null,8,["id-spot"]),e("h4",{style:ne({textAlign:"center",color:q(h).accentColor})},[e("b",it,"SPOT: "+W(o.chartName),1)],4),d.value.length?($(),L("p",{key:1,style:{"text-align":"center","margin-bottom":"5px"},class:te(q(h).textTheme)}," Displaying data for last "+W(o.filterTime)+" hour(s) on "+W(o.filterDate),3)):ee("",!0),e("div",{ref_key:"chartRef",ref:V,style:{width:"100%",height:"600px"}},null,512)],14,st)],64)}}}),ut={class:"cl-filter"},dt={key:0,class:"trunk-selector"},ct={style:{width:"500px",display:"flex",padding:"15px","flex-flow":"column"}},pt=["value"],vt={style:{width:"500px",display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem",position:"relative"}},mt={style:{display:"flex","flex-flow":"column","align-items":"center"}},ft={style:{display:"flex","flex-flow":"row wrap","justify-content":"center"}},yt=["onClick"],ht=me({__name:"ChartLayerView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(X){const B=l(null),M=l(null),F=l(Ie().getAllTrunk()),y=r=>new Date(r).toISOString(),d=X,T=l(d.dateFilter),h=l("15"),m=l({legend:{show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",name:"Time",data:[],nameGap:40,boundaryGap:0,nameLocation:"center",axisLabel:{show:!0,rotate:45,interval:r=>b.value[r]===void 0?!1:b.value[r].split(":")[1]%h.value===0},axisSplitLine:{show:!0,lineStyle:{type:"solid"}},axisLine:{show:!0,lineStyle:{type:"solid"}}},yAxis:{type:"value",min:0,max:550,interval:50,minorTick:{show:!0},scale:!0,nameLocation:"center",nameGap:50,boundaryGap:0,splitLine:{show:!0,lineStyle:{type:"solid",color:"#00000055"}},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#00000022"}},axisTick:{show:!0},name:"Pressure (PSI)",axisLine:{show:!0}},series:[]});N(()=>h.value,()=>{m.value.xAxis.axisLabel.interval=r=>b.value[r].split(":")[1]%h.value===0,C()}),N(()=>T.value,()=>{Object.keys(D.value).length>0&&j()});const D=l({}),V=l(),C=()=>{M.value.setOption(m.value)};N(()=>B.value,()=>{M.value=ge(B.value),C()});const I=l({}),b=l([]),Y=l(!1),o=()=>{const r=V.value,s=F.value[r].name,S=F.value[r].spot;D.value[s]=S,Y.value=!1,I.value={},b.value=[],M.value.clear(),m.value.series=[],M.value.setOption(m.value),j()},j=()=>{Object.keys(D.value).forEach(async r=>{const s=[],S=[];for(let p=0;p<D.value[r].length;p++){const J={id:D.value[r][p].id+"",date:y(T.value),timespan:d.timeFilter+"",firstrequest:!0},w=await we().httpPost("api/Data/getsingledata",J),P=w.map(f=>f.psiValue.toFixed(2));S.push({type:"line",data:P,smooth:!1,symbol:"none",name:D.value[r][p].name});const z=w.map(f=>Re(f.timestamp).format("HH:mm"));for(let f=0;f<z.length;f++)s.includes(z[f])||s.push(z[f])}I.value[r]=S,b.value=s})};N(()=>I,()=>{M.value.clear(),M.value.setOption(m.value),c()},{deep:!0});const c=()=>{m.value.xAxis.data=b.value,Object.keys(I.value).forEach(r=>{for(let s=0;s<I.value[r].length;s++)m.value.series.push(I.value[r][s])}),M.value.setOption(m.value)},k=r=>{delete D.value[r],j()};return(r,s)=>{const S=be("font-awesome-icon");return $(),L(ue,null,[e("div",ut,[Y.value?($(),L("div",dt,[e("button",{onClick:s[0]||(s[0]=p=>Y.value=!Y.value),type:"button",class:"drwclose"},[a(S,{icon:"close"})]),e("div",ct,[s[7]||(s[7]=e("h5",null,[e("b",null,"Trunkline Preference")],-1)),a(de,{"in-label":"Trunkline",style:{width:"100%"},"model-value":V.value,"onUpdate:modelValue":s[1]||(s[1]=p=>V.value=p)},{default:_(()=>[s[5]||(s[5]=e("option",{selected:"",value:""},"Select Trunkline...",-1)),($(!0),L(ue,null,he(F.value,(p,R)=>($(),L("option",{key:R,value:R},W(p.name),9,pt))),128))]),_:1},8,["model-value"]),a(E,{onClick:o,"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content",padding:"13px",width:"170px"}},{default:_(()=>s[6]||(s[6]=[Z("Load into Chart")])),_:1})])])):ee("",!0),s[9]||(s[9]=e("h3",null,[e("b",null,"Chart Layer")],-1)),e("div",vt,[a(se,{"in-type":"date","in-label":"Date Filter","model-value":T.value,"onUpdate:modelValue":s[2]||(s[2]=p=>T.value=p)},null,8,["model-value"]),a(de,{"in-label":"X-Axis Gap",style:{width:"100%"},"model-value":h.value,"onUpdate:modelValue":s[3]||(s[3]=p=>h.value=p)},{default:_(()=>s[8]||(s[8]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),a(E,{onClick:s[4]||(s[4]=p=>Y.value=!Y.value),"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content","margin-top":"36px",padding:"13px"}},{default:_(()=>[a(S,{icon:"plus"})]),_:1})])]),e("div",{ref_key:"chart",ref:B,style:{width:"100%",height:"480px"}},null,512),s[11]||(s[11]=e("hr",null,null,-1)),e("div",mt,[s[10]||(s[10]=e("label",null,[e("b",null,"Active Trunklines")],-1)),e("div",ft,[($(!0),L(ue,null,he(D.value,(p,R)=>($(),L("span",{class:"active-trunklines",key:R,onClick:J=>k(R),style:{margin:"5px"}},[e("span",null,W(R),1)],8,yt))),128))])])],64)}}}),gt=$e(ht,[["__scopeId","data-v-a1bd2a50"]]),bt={key:0,class:"chart-layer"},wt={class:"chart-layer-inner"},xt={key:1,class:"live-window"},kt={key:2,class:"live-window"},St={key:3,class:"drw-wd"},Tt={class:"row"},Ct={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},$t={class:"col-md-12"},_t={class:"col-md-12"},Mt={style:{display:"flex","flex-flow":"row nowrap",gap:"0.4rem"}},Dt={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},It={class:"spot-reading-control"},At={class:"spot-basket"},Lt=["onClick","onDblclick"],Ot={key:0,style:{"margin-top":"1rem",display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Xt=me({__name:"MonitoringFol",setup(X){var ve;let B=null;try{const i=localStorage.getItem("user");B=i?JSON.parse(i):null}catch(i){console.error("Failed to parse localStorage user:",i)}console.log("Stored user:",JSON.stringify(B,null,2));const M=((ve=B==null?void 0:B.field)==null?void 0:ve.field_id)||"jbi",F=ze("https://flipapi.rndkito.com");F.emit("joinField",M),F.on("connect",()=>{console.log("Socket Connected:",F.id)}),F.on("disconnect",()=>{console.log("Disconnected")}),F.on("pressure:new",i=>{if((i==null?void 0:i.field_id)!==M||I.value)return;const t=Number(i==null?void 0:i.psi);Number.isFinite(t)&&(y[i.spot_id]={ts:String(i.timestamp),val:t},console.log("liveFeed updated",i.spot_id,y[i.spot_id]))});const y=Ve({}),d=fe();d.asideToggle(!0);const T=l(null),h=l(!1),m=l(350),D=l(0),V=l(30),C=l(3e3),I=l(!1),b=l(""),Y=l(!1),o=l(24),j=l(!1),c=l([]),k=l(0),r=()=>{k.value<c.value.length&&setTimeout(()=>{k.value++,r()},100)},s=()=>{const i=new Date,t=i.getFullYear(),x=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),le=`${t}-${x}-${n}`;b.value=le},S=()=>{document.visibilityState==="visible"?setTimeout(()=>{I.value=!1,d.notifyShow("Resuming data fetch")},3e3):I.value=!0};Ce(()=>{ae(),s(),r(),document.addEventListener("visibilitychange",S)}),xe(()=>{document.removeEventListener("visibilitychange",S)});const p=()=>{j.value=!0},R=i=>{j.value=!1,c.value.some(x=>x.id===i.id)?d.notifyShowError("Selected spot already displayed"):c.value.push(i)},J=i=>{c.value=c.value.filter(t=>!t[i])},ae=async()=>{try{const t=(await qe({field_id:M})).trunklines.flatMap(x=>x.spots.map(n=>({id:n.spot_id,name:n.spot_name,desc:x.tline_name,safemark:n.safe_mark||0,yMax:n.y_max||500,yInterval:n.y_interval||20})));c.value=t,console.log("spots ",c.value)}catch(i){console.error("Failed to fetch spots:",i)}},w=l(!1),P=()=>{w.value=!w.value},z=()=>{w.value=!1,d.notifyShow("Options has been applied")},f=i=>{const t=document.getElementById("chart"+i);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},O=()=>{h.value=!h.value},A=i=>{c.value=c.value.filter(t=>!t[i])};let G=l([]);const U=i=>{G.value.push({id:i});const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="red",x.style.color="white"):console.warn(`Element dengan class ${t} gak ditemukan bro!`)},K=i=>{const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="#000",x.style.color="#fff"):console.warn(`Element dengan class ${t} gak ditemukan bro!`);const n=G.value.findIndex(le=>le.id===i);G.value.splice(n,1)},Q=()=>{I.value=!1},ie=()=>{I.value=!0},re=async i=>{},ce=l(!1),ye=i=>{console.log("gg"),I.value=!0,ce.value=!0,c.value.length>0?(console.log("masuk1"),pe()):console.log("tutup")},pe=async i=>{const t=ge(T.value);await re().then(x=>{const n=x.cats,le=x.series,ke={graphic:[{type:"rect",shape:{x:0,y:0,width:t.getWidth(),height:t.getHeight()},style:{fill:"transparent"}}],backgroundColor:"#fff",tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value",min:0,max:350},series:[{type:"line",data:le,color:n.map(()=>`${d.accentColor}`)}]};t.setOption(ke),t.setOption({yAxis:{name:"Pressure (PSI)"}})})},v=()=>{ce.value=!1},u=l(!1),H=()=>{u.value=!1},g=l(!1),oe=l(!1);return N(()=>oe.value,()=>{oe.value?I.value=!0:I.value=!1}),N(()=>c.value.length,(i,t)=>{i>t&&k.value<i&&(k.value++,setTimeout(r,0))}),(i,t)=>{const x=be("font-awesome-icon");return $(),L(ue,null,[oe.value?($(),L("div",bt,[e("div",wt,[e("button",{onClick:t[0]||(t[0]=n=>oe.value=!oe.value),type:"button",class:"drwclose"},[a(x,{icon:"close"})]),a(gt,{"date-filter":b.value,"time-filter":o.value},null,8,["date-filter","time-filter"])])])):ee("",!0),g.value?($(),L("div",xt,[e("div",{class:te(["live-window-inner",[`${q(d).mTheme}`]])},[e("button",{onClick:t[1]||(t[1]=n=>g.value=!g.value),type:"button",class:"drwclose"},[a(x,{icon:"close"})]),a(at,{"date-filter":b.value,"time-filter":o.value},null,8,["date-filter","time-filter"])],2)])):ee("",!0),u.value?($(),L("div",kt,[e("div",{class:te(["live-window-inner",[`${q(d).mTheme}`]])},[e("button",{type:"button",class:"drwclose",onClick:H},[a(x,{icon:"close"})]),a(Qe,{"date-filter":b.value,"time-filter":o.value},null,8,["date-filter","time-filter"])],2)])):ee("",!0),ce.value?($(),L("div",St,[e("div",{class:"drw-inner",style:ne({background:`${q(d).themeDarkColor}`})},[e("button",{onClick:v,type:"button",style:ne({color:`${q(d).accentColor}`}),class:"drwclose"},[a(x,{icon:"close"})],4),e("div",{ref_key:"eCharts",ref:T,style:{width:"100%",height:"100%",position:"relative"}},null,512)],4)])):ee("",!0),a(Te,{"mod-show":j.value,"onUpdate:modShow":t[2]||(t[2]=n=>j.value=n),"mod-title":"Select spot"},{default:_(()=>[($(!0),L(ue,null,he(c.value,(n,le)=>($(),Se(We,{key:le,onOnItemSelect:R,"item-id":n.id,"item-name":n.name,"item-desc":n.desc,"item-safemark":n.safemark},null,8,["item-id","item-name","item-desc","item-safemark"]))),128))]),_:1},8,["mod-show"]),a(Te,{"mod-show":w.value,"onUpdate:modShow":t[8]||(t[8]=n=>w.value=n),"mod-title":"Global Chart Preference"},{default:_(()=>[e("p",{style:ne({color:q(d).accentColor})},"These parameters applies to all displayed charts",4),a(se,{"in-label":"Y-Axis Max Tick Range","in-type":"number","model-value":m.value,"onUpdate:modelValue":t[3]||(t[3]=n=>m.value=n)},null,8,["model-value"]),a(se,{"in-label":"Y-Axis Min Tick Range","in-type":"number","model-value":D.value,"onUpdate:modelValue":t[4]||(t[4]=n=>D.value=n)},null,8,["model-value"]),a(se,{"in-label":"X-Axis Tick Amount","in-helper":"Greater value produces denser tick rates while lesser value loosen it but trims certain data in some points of time","in-type":"number","model-value":V.value,"onUpdate:modelValue":t[5]||(t[5]=n=>V.value=n)},null,8,["model-value"]),a(se,{"in-label":"Data Update Interval (Milisecond)","in-helper":"Higher value increases the delay while lower value decreases it. Warning: Lower value require more resources and may significantly affect client-side performance","in-type":"number","model-value":C.value,"onUpdate:modelValue":t[6]||(t[6]=n=>C.value=n)},null,8,["model-value"]),a(de,{"in-label":"Curve Type","model-value":Y.value,"onUpdate:modelValue":t[7]||(t[7]=n=>Y.value=n)},{default:_(()=>t[14]||(t[14]=[e("option",{value:!0},"Smooth",-1),e("option",{value:!1},"Straight",-1)])),_:1},8,["model-value"]),a(E,{onClick:z,"bt-type":"button","bt-disabled":!1},{default:_(()=>t[15]||(t[15]=[Z("Dismiss")])),_:1})]),_:1},8,["mod-show"]),a(Ne,{"context-title":"Monitoring FOL"},{default:_(()=>[e("div",Tt,[e("div",Ct,[a(E,{onClick:P,"bt-size":"small","bt-disabled":!1},{default:_(()=>[a(x,{icon:"sliders"}),t[16]||(t[16]=Z(" Global Chart Preferences"))]),_:1})]),e("div",$t,[a(se,{"in-type":"date","in-label":"Date Filter","model-value":b.value,"onUpdate:modelValue":t[9]||(t[9]=n=>b.value=n)},null,8,["model-value"]),a(de,{"in-label":"Time Range Filter","model-value":o.value,"onUpdate:modelValue":t[10]||(t[10]=n=>o.value=n)},{default:_(()=>t[17]||(t[17]=[e("option",{value:"1"},"1 Hour",-1),e("option",{value:"3"},"3 Hours",-1),e("option",{value:"6"},"6 Hours",-1),e("option",{value:"12"},"12 Hours",-1),e("option",{value:"24"},"24 Hours",-1)])),_:1},8,["model-value"]),e("div",_t,[e("div",Mt,[a(E,{onClick:t[11]||(t[11]=n=>u.value=!u.value),"bt-size":"small","bt-disabled":!1},{default:_(()=>[a(x,{icon:"chart-line"}),t[18]||(t[18]=Z(" Live Monitor "))]),_:1}),a(E,{"bt-size":"small",onClick:t[12]||(t[12]=n=>g.value=!g.value),"bt-disabled":!1},{default:_(()=>[a(x,{icon:"chart-line"}),t[19]||(t[19]=Z(" Trunkline Monitor "))]),_:1}),a(E,{"bt-size":"small",onClick:t[13]||(t[13]=n=>oe.value=!oe.value),"bt-disabled":!1},{default:_(()=>[a(x,{icon:"chart-line"}),t[20]||(t[20]=Z(" Chart Layer "))]),_:1})])]),e("div",Dt,[a(E,{onClick:p,"bt-type":"button","bt-disabled":!1,"bt-size":"small"},{default:_(()=>[a(x,{icon:"add"}),t[21]||(t[21]=Z(" Add Chart"))]),_:1})]),e("div",It,[a(E,{onClick:Q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[a(x,{icon:"play"}),t[22]||(t[22]=Z(" Resume All"))]),_:1}),a(E,{onClick:ie,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[a(x,{icon:"pause"}),t[23]||(t[23]=Z(" Pause All"))]),_:1})]),e("div",At,[($(!0),L(ue,null,he(c.value,n=>($(),L("span",{key:n.id,class:te(["spot-data",[`spotdata-${n.id}`]]),onClick:le=>f(n.id),onDblclick:le=>J(n.id),title:"Click to navigate to this spot"},W(n.name)+" ("+W(n.desc)+") ",43,Lt))),128))]),c.value.length?($(),L("div",Ot,[a(E,{onClick:O,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[a(x,{icon:h.value?"grip-vertical":"expand"},null,8,["icon"]),Z(" "+W(h.value?"Grid chart view":"Full chart view"),1)]),_:1})])):ee("",!0),c.value.length>0?($(),L("div",{key:1,class:te(h.value?"chart-basket-gridview":"chart-basket-fullview")},[($(!0),L(ue,null,he(c.value,(n,le)=>($(),L("div",{key:n.id,class:"chart-wrapper"},[le<k.value?($(),Se(rt,{key:0,onOnChartReady:r,id:"chart"+n.id,"chart-name":n.name,"filter-date":b.value,"filter-time":o.value,"safe-mark":n.safemark,"spot-id":n.id,"curve-type":Y.value,"y-max":n.yMax,"y-min":D.value,"tick-amount":V.value,"y-interval":n.yInterval,"data-fetch-interval":C.value,gridview:h.value,"is-data-paused":I.value,"live-point":y[n.id],onOnDrawingMode:ye,onOnChartClose:A,onOnPause:U,onOnResume:K},null,8,["id","chart-name","filter-date","filter-time","safe-mark","spot-id","curve-type","y-max","y-min","tick-amount","y-interval","data-fetch-interval","gridview","is-data-paused","live-point"])):ee("",!0)]))),128))],2)):ee("",!0)])])]),_:1})],64)}}});export{Xt as default};
