import{u as me}from"./index-CnL09n3A.js";import{d as _e,i as ye}from"./index-B5d4h4Xc.js";import{_ as Ae}from"./MainWrapperView.vue_vue_type_style_index_0_lang-CgQxC6h5.js";import{_ as se}from"./InputView.vue_vue_type_style_index_0_lang-DwlRu3fL.js";import{_ as ce}from"./SelectView.vue_vue_type_style_index_0_lang-DPixZ617.js";import{_ as X}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-CxbBZc9q.js";import{d as pe,c as A,k as te,e,f as ne,u as R,a as o,r as he,n as le,t as Y,q as Le,o as C,l as ee,w as _,g as l,i as N,h as Se,j as be,_ as Te,F as de,v as Ce,x as $e,b as xe,y as fe,z as Oe}from"./index-C2CCN2NB.js";import{u as ge}from"./http-DrjsCXOO.js";import{t as Me}from"./trunk-dwr8fwI0.js";import{_ as Ne}from"./BatteryView.vue_vue_type_style_index_0_computed_true_lang-O75W1-WL.js";import{a as Fe,g as Ve}from"./folService-MCIdZNKB.js";import{h as Pe}from"./moment-C5S46NFB.js";import{l as Ue}from"./index-TjCxX7sJ.js";import"./api-tIjG661J.js";const qe={key:0,class:"mod-overlay"},Re={class:"mod-heading"},ze={class:"mod-body"},ke=pe({__name:"ModalEditorView",props:{modTitle:{type:String,required:!0},modShow:{type:Boolean,default:!0}},emits:["update:modShow"],setup(J,{emit:B}){const y=me(),$=J,c=B,g=()=>{c("update:modShow",!$.modShow)};return(M,L)=>{const d=he("font-awesome-icon");return J.modShow?(C(),A("div",qe,[e("div",{class:le(["mod-content",R(y).mTheme])},[e("button",{onClick:g,type:"button",class:"mod-dismiss",style:ne({color:R(y).accentColor})},[o(d,{icon:"times"})],4),e("div",Re,[e("h4",{class:le(R(y).textTheme)},[e("b",null,Y(J.modTitle),1)],2)]),e("div",ze,[Le(M.$slots,"default")])],2)])):te("",!0)}}}),Ge={class:"itemlist-wrapper"},je={class:"itemlist-group"},Be=pe({__name:"ItemList",props:{itemName:{type:String,required:!0},itemDesc:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemSafemark:{type:Number,default:0,required:!0}},emits:["onItemSelect"],setup(J,{emit:B}){const y=me(),$=B,c=J,g=()=>{$("onItemSelect",{id:c.itemId,name:c.itemName,desc:c.itemDesc})};return(M,L)=>{const d=he("font-awesome-icon");return C(),A("div",Ge,[e("div",je,[e("span",{style:ne({color:R(y).accentColor})},[e("b",null,Y(J.itemName),1)],4),e("span",{style:ne({color:R(y).accentColor})},[o(d,{icon:"map-pin"}),ee(" "+Y(J.itemDesc),1)],4)]),o(X,{onClick:g,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(d,{icon:"plus"})]),_:1})])}}}),He={class:"chart-containers"},Ee={class:"col-md-4"},We={class:"loaderparent"},Xe=pe({__name:"LiveMonitorChart",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(J){const B=J,y=l(!0),$=l(null),c=l(null),g=me(),M=l(15),L=l([]),d=l(0),m=l("Building chart..."),G=l("Initializing..."),h=l(0),P=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),a=T=>new Date(T).toISOString(),U=async()=>new Promise(async(T,k)=>{await ge().httpGet("api/Spot/getspots").then(u=>{T(u)}).catch(u=>{console.error(u),k(u)})});N(()=>$.value,async()=>{H(),await U().then(T=>{L.value=T})});const H=()=>{if(d.value=5,$.value){const T=ye($.value);c.value=T,c.value.setOption(P.value)}},S=async()=>new Promise(async(T,k)=>{try{const u=[],s=new Set,b=L.value.length;let p=0;G.value="Setting up...";for(let D=0;D<L.value.length;D++){G.value=`Applying filter for ${L.value[D].spotName}...`;const K={id:L.value[D].id+"",date:a(B.dateFilter),timespan:B.timeFilter+"",firstrequest:y.value},F=await ge().httpPost("api/Data/getsingledata",K);for(let E=0;E<F.length;E++)setTimeout(()=>{h.value++},1);const v=F.map(E=>{const Q=E.timestamp.replace(".",":").split("T")[1],[Z,ie]=Q.split(":"),re=`${Z}:${ie}`;return s.add(re),re}),O=F.map(E=>parseFloat(E.psiValue));u.push({psies:O,categories:v}),p+=1;const I=p/b*90;d.value=Math.round(I)}const j=Array.from(s).sort((D,K)=>{const[F,v]=D.split(":").map(Number),[O,I]=K.split(":").map(Number);return F!==O?F-O:v-I}),oe=u.map((D,K)=>{const F={};D.categories.forEach((O,I)=>{F[O]=D.psies[I]});const v=j.map(O=>F[O]!==void 0?parseFloat(F[O]):null);return{name:`${L.value[K].spotName}`,type:"line",data:v,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:1},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(O){let I=0;const E=u[O.seriesIndex].psies.length;for(let q=0;q<E;q++)u[O.seriesIndex].psies[q]!==null&&(I=u[O.seriesIndex].psies[q].toFixed(2));return I}}}}),z={backgroundColor:"transparent",legend:{data:oe.map(D=>({name:D.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:j,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(D){return D.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${g.accentColor}`,rotate:-45,interval:D=>{const[K,F]=j[D].split(":").map(Number);return F%M.value===0},formatter:function(D){return D}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:oe};T(z)}catch(u){console.error(u),k(u)}});return N(()=>L.value,async()=>{await S().then(T=>{c.value.setOption(T),G.value="Drawing series...",d.value=99.99,setTimeout(()=>{d.value=100,h.value=0},2e3)})}),N(()=>M.value,async()=>{d.value=5,G.value="Setting up...",m.value="Options & filter updated. Rebuilding chart with new series...",c.value&&(c.value=null),H(),setTimeout(async()=>{await S().then(T=>{c.value.setOption(T),d.value=99.99,G.value="Drawing series...",setTimeout(()=>{d.value=100,h.value=0},2e3)})},1e3)}),Se(()=>{H()}),be(()=>{$.value&&_e($.value)}),(T,k)=>(C(),A("div",He,[e("h3",{style:{padding:"15px"},class:le([`${R(g).textTheme}`])},k[1]||(k[1]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Ee,[o(ce,{"in-label":"X-Axis Time Split","model-value":M.value,"onUpdate:modelValue":k[0]||(k[0]=u=>M.value=u)},{default:_(()=>k[2]||(k[2]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:$,style:{width:"100%",position:"relative",height:"90%"}},null,512),d.value!=100?(C(),A("div",{key:0,class:le(["chartloader",[`${R(g).mTheme}`]])},[k[3]||(k[3]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:le([`${R(g).textTheme}`])},Y(m.value)+" ("+Y(h.value)+" objects collected)",3),e("span",{style:ne({color:`${R(g).accentColorSecondary}`})},Y(G.value),5),e("div",We,[e("span",{style:ne({width:`${d.value}%`,background:`${R(g).accentColor}`}),class:"loaderinner"},null,4)])],2)):te("",!0)]))}}),Ye=Te(Xe,[["__scopeId","data-v-69f62916"]]),Je={class:"chart-containers"},Ke={class:"col-md-4"},Qe={class:"loaderparent"},Ze=pe({__name:"LiveMonitorSegmentView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(J){const B=Me(),y=J,$=l(!0),c=l(null),g=l(null),M=me(),L=l(15),d=l([]),m=l(0),G=l("Building chart..."),h=l("Initializing..."),P=l(0),a=l("trunk1"),U=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),H=l({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),S=s=>new Date(s).toISOString(),T=()=>{d.value=B.getTrunk(a.value).spot};N(()=>c.value,()=>{k(),T()});const k=()=>{if(m.value=5,c.value){const s=ye(c.value);g.value=s,g.value.setOption(U.value)}},u=async()=>new Promise(async(s,b)=>{try{const p=[],j=new Set,oe=d.value.length;let z=0;h.value="Setting up...";for(let v=0;v<d.value.length;v++){h.value=`Applying filter for ${d.value[v].spotName}...`;const O={id:d.value[v].id+"",date:S(y.dateFilter),timespan:y.timeFilter+"",firstrequest:$.value},I=await ge().httpPost("api/Data/getsingledata",O);for(let Z=0;Z<I.length;Z++)setTimeout(()=>{P.value++},1);const E=I.map(Z=>{const re=Z.timestamp.replace(".",":").split("T")[1],[f,r]=re.split(":"),V=`${f}:${r}`;return j.add(V),V}),q=I.map(Z=>parseFloat(Z.psiValue));p.push({psies:q,categories:E}),z+=1;const Q=z/oe*90;m.value=Math.round(Q)}const D=Array.from(j).sort((v,O)=>{const[I,E]=v.split(":").map(Number),[q,Q]=O.split(":").map(Number);return I!==q?I-q:E-Q}),K=p.map((v,O)=>{const I={};v.categories.forEach((q,Q)=>{I[q]=v.psies[Q]});const E=D.map(q=>I[q]!==void 0?parseFloat(I[q]):null);return{name:`${d.value[O].spotName}`,type:"line",data:E,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:2},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(q){let Q=0;const Z=p[q.seriesIndex].psies.length;for(let ie=0;ie<Z;ie++)p[q.seriesIndex].psies[ie]!==null&&(Q=p[q.seriesIndex].psies[ie].toFixed(2));return Q}}}}),F={backgroundColor:"transparent",legend:{data:K.map(v=>({name:v.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:D,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(v){return v.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${M.accentColor}`,rotate:-45,interval:v=>{const[O,I]=D[v].split(":").map(Number);return I%L.value===0},formatter:function(v){return v}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:K};s(F)}catch(p){console.error(p),b(p)}});return N(()=>d.value,async()=>{await u().then(s=>{g.value.setOption(s),h.value="Drawing series...",m.value=99.99,setTimeout(()=>{m.value=100,P.value=0},2e3)})}),N(()=>L.value,async()=>{m.value=5,h.value="Setting up...",G.value="Options & filter updated. Rebuilding chart with new series...",g.value&&(g.value=null),k(),setTimeout(async()=>{await u().then(s=>{g.value.setOption(s),m.value=99.99,h.value="Drawing series...",setTimeout(()=>{m.value=100,P.value=0},2e3)})},1e3)}),Se(()=>{k()}),be(()=>{c.value&&_e(c.value)}),N(()=>a.value,()=>{d.value=B.getTrunk(a.value).spot,g.value.clear(),g.value.setOption(H),k()}),(s,b)=>(C(),A("div",Je,[e("h3",{style:{padding:"15px"},class:le([`${R(M).textTheme}`])},b[2]||(b[2]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Ke,[o(ce,{"in-label":"Select Spot","model-value":a.value,"onUpdate:modelValue":b[0]||(b[0]=p=>a.value=p)},{default:_(()=>b[3]||(b[3]=[e("option",{value:"trunk1"},"MGS BJG - BOOSTER",-1),e("option",{value:"trunk2"},"MGS KAS - MOS SPPP",-1),e("option",{value:"trunk3"},"SGL LINE",-1),e("option",{value:"trunk4"},"BETUNG - BAJUBANG",-1)])),_:1},8,["model-value"]),o(ce,{"in-label":"X-Axis Time Split","model-value":L.value,"onUpdate:modelValue":b[1]||(b[1]=p=>L.value=p)},{default:_(()=>b[4]||(b[4]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:c,style:{width:"100%",position:"relative",height:"100%"}},null,512),m.value!=100?(C(),A("div",{key:0,class:le(["chartloader",[`${R(M).mTheme}`]])},[b[5]||(b[5]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:le([`${R(M).textTheme}`])},Y(G.value)+" ("+Y(P.value)+" objects collected)",3),e("span",{style:ne({color:`${R(M).accentColorSecondary}`})},Y(h.value),5),e("div",Qe,[e("span",{style:ne({width:`${m.value}%`,background:`${R(M).accentColor}`}),class:"loaderinner"},null,4)])],2)):te("",!0)]))}}),et=Te(Ze,[["__scopeId","data-v-40464d3f"]]),tt={style:{display:"flex","flex-flow":"column","margin-bottom":"1rem"}},lt=["id"],at={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end",gap:"0.5rem","margin-bottom":"1.5rem"}},ot={contenteditable:"true",spellcheck:"false"},st=pe({__name:"ChartView2",props:{filterDate:{type:String,required:!0},filterTime:{type:Number,required:!0},spotId:{type:String,required:!0},chartName:{type:String,required:!0},yMax:{type:Number,required:!0,default:350},yMin:{type:Number,required:!0,default:0},gridview:{type:Boolean,default:!1},tickAmount:{type:Number,default:100},dataFetchInterval:{type:Number,default:1e4},curveType:{type:Boolean,default:!1},safeMark:{type:Number,default:0},isDataPaused:Boolean,showUis:{type:Boolean,default:!0},yInterval:{type:Number,default:0},livePoint:{type:Object,required:!1}},emits:["onChartClose","onChartReady","onPause","onResume","onDrawingMode"],setup(J,{emit:B}){const y=l([]),$=l([]),c=B,g=me(),M=l(!1),L=l(!0),d=l(null),m=l(null),G=l(!1),h=l(!1);let P;const a=J,U=l(a.safeMark),H=l(!1),S=l(a.yMax),T=l(a.yMin),k=l(a.tickAmount),u=l(50),s=l(a.dataFetchInterval),b=l(a.curveType),p=l(!0),j=l(!0);function oe(f,r){return{tooltip:{show:!0,trigger:"item",axisPointer:{type:"cross",axis:"auto",label:{show:!0}}},xAxis:[{type:"category",interval:k.value,axisLine:{show:!0,lineStyle:{color:g.accentColor}},splitLine:{show:j,lineStyle:{color:"#ddd",type:"dashed"}},axisTick:{show:!0},boundaryGap:!1,axisLabel:{rotate:45},data:[]}],yAxis:[{type:"value",min:0,max:f,minorTick:{show:!0},axisTick:{show:!0},minorSplitLine:{show:p,lineStyle:{color:"#ddd",type:"dashed"}},interval:a.yInterval,axisLine:{show:!0,lineStyle:{color:g.accentColor}}}],series:[{name:"PSI Data",type:"line",symbol:"none",data:[],smooth:a.curveType,lineStyle:{width:1.2,join:"miter",miterLimit:3,cap:"round"},tooltip:{position:["50%","50%"]},endLabel:{show:!0,distance:0,color:"black",backgroundColor:"white",padding:5,borderRadius:5}},{name:"Safe Mark",type:"line",tooltip:{trigger:"item"},lineStyle:{color:"red",type:"solid"},markLine:{symbol:"none",label:{show:!1},lineStyle:{color:"red",type:"dashed"},data:[{yAxis:U.value}]}}]}}N(()=>U.value,()=>{var f;z.value.series[1].markLine.data[0].yAxis=U.value,(f=m.value)==null||f.setOption(z.value)});const z=l(oe(a.yMax,a.curveType));N(()=>[S.value,T.value,k.value,s.value,b.value,u.value,p.value,j.value],()=>{m.value.setOption(z.value)});const D=()=>{var f;!m.value&&d.value&&(m.value=ye(d.value)),(f=m.value)==null||f.setOption(z.value)},K=f=>new Date(f).toISOString(),F=async()=>{var f;try{const r=typeof K=="function"?K(a.filterDate):new Date(a.filterDate).toISOString(),V=await Fe({field_id:"jbi",spot_id:a.spotId,timestamp:r}),w=Array.isArray(V==null?void 0:V.data)?V.data:Array.isArray(V)?V:[],ve=w.map(W=>{const i=String(W.timestamp??""),t=i.replace(".",":");if(t.includes("T")){const we=t.split("T")[1]||"",[De="00",Ie="00"]=we.split(":");return`${De}:${Ie}`}const x=new Date(i||r),n=String(x.getHours()).padStart(2,"0"),ae=String(x.getMinutes()).padStart(2,"0");return`${n}:${ae}`}),ue=w.map(W=>{const i=Number(W.psiValue??W.psi??W.value);return isFinite(i)?i:NaN}).map(W=>Number(isFinite(W)?W.toFixed(2):"NaN"));y.value=ve,$.value=ue,ue.length&&ue.some(W=>isFinite(W))?(G.value=!1,z.value.xAxis[0].data=ve,z.value.series[0].data=ue,(f=m.value)==null||f.setOption(z.value)):(G.value=!0,L.value=!1)}catch(r){console.error(r)}};N(()=>d.value,()=>{d.value&&D()}),N(()=>a.gridview,()=>{m.value&&setTimeout(()=>{var f;(f=m.value)==null||f.resize()},500)}),N(()=>a.dataFetchInterval,()=>{s.value=a.dataFetchInterval}),N(()=>[d.value],()=>{F()}),be(()=>{clearInterval(P)});let v=null;N(()=>[a.filterDate,a.filterTime,a.yMax,a.yMin,a.tickAmount,a.curveType],()=>{v&&clearTimeout(v),v=setTimeout(()=>{S.value=a.yMax,T.value=a.yMin,k.value=a.tickAmount,b.value=a.curveType,s.value=a.dataFetchInterval,z.value=oe(a.yMax,a.curveType),L.value=!0,M.value=!1},300)});let O=null;N(()=>[S.value,T.value,k.value,s.value,b.value],()=>{O&&clearTimeout(O),O=setTimeout(()=>{F()},500)}),g.$subscribe((f,r)=>{setTimeout(()=>{F()},2e3)});const I=()=>{c("onChartClose",a.spotId)},E=()=>{H.value=!H.value},q=()=>{H.value=!1},Q=()=>{h.value=!h.value,h.value?c("onPause",a.spotId):c("onResume",a.spotId)};N(()=>[a.isDataPaused],()=>{h.value=a.isDataPaused,h.value?c("onPause",a.spotId):c("onResume",a.spotId)}),N(()=>h.value,()=>{h.value?c("onPause",a.spotId):c("onResume",a.spotId)}),N(()=>g.asideVisible,()=>{m.value&&setTimeout(()=>{var f;(f=m.value)==null||f.resize()},500)});const Z=()=>{c("onDrawingMode",a.spotId)},ie=f=>{const r=f.includes("T")?f:f.replace(" ","T"),V=new Date(r),w=String(V.getHours()).padStart(2,"0"),ve=String(V.getMinutes()).padStart(2,"0");return`${w}:${ve}`},re=f=>{if(!y.value.length)return!0;const r=y.value[y.value.length-1],V=new Date((a.filterDate+" "+r).replace(" ","T"));return new Date(f.includes("T")?f:f.replace(" ","T")).getTime()>V.getTime()};return N(()=>a.livePoint,f=>{var w;if(!f||h.value)return;const r=Number(f.val);if(!Number.isFinite(r))return;const V=ie(f.ts);if(y.value.length&&y.value[y.value.length-1]===V)$.value[$.value.length-1]=Number(r.toFixed(2));else{if(!re(f.ts))return;y.value.push(V),$.value.push(Number(r.toFixed(2)))}G.value=!1,z.value.xAxis[0].data=y.value,z.value.series[0].data=$.value,(w=m.value)==null||w.setOption({xAxis:[{data:y.value}],series:[{data:$.value},{}]})}),(f,r)=>{const V=he("font-awesome-icon");return C(),A(de,null,[o(ke,{"mod-show":H.value,"onUpdate:modShow":r[9]||(r[9]=w=>H.value=w),"mod-title":`${a.chartName} Preferences`},{default:_(()=>[o(se,{"in-type":"number","in-label":"Safemark","model-value":U.value,"onUpdate:modelValue":r[0]||(r[0]=w=>U.value=w)},null,8,["model-value"]),o(se,{"in-type":"number","in-label":"Y-Axis Max Tick","model-value":S.value,"onUpdate:modelValue":r[1]||(r[1]=w=>S.value=w)},null,8,["model-value"]),o(se,{"in-type":"number","in-label":"Y-Axis Min Tick","model-value":T.value,"onUpdate:modelValue":r[2]||(r[2]=w=>T.value=w)},null,8,["model-value"]),o(se,{"in-type":"number","in-label":"Y-Axis Interval","model-value":u.value,"onUpdate:modelValue":r[3]||(r[3]=w=>u.value=w)},null,8,["model-value"]),o(se,{"in-type":"number","in-label":"X-Axis Tick Amount","model-value":k.value,"onUpdate:modelValue":r[4]||(r[4]=w=>k.value=w)},null,8,["model-value"]),o(se,{"in-type":"number","in-label":"Data Update Interval (Milisecond)","model-value":s.value,"onUpdate:modelValue":r[5]||(r[5]=w=>s.value=w)},null,8,["model-value"]),o(ce,{"in-label":"Curve Type","model-value":b.value,"onUpdate:modelValue":r[6]||(r[6]=w=>b.value=w)},{default:_(()=>r[10]||(r[10]=[e("option",{value:"true"},"Smooth",-1),e("option",{value:"false"},"Straight",-1)])),_:1},8,["model-value"]),e("div",tt,[e("label",null,[Ce(e("input",{type:"checkbox","onUpdate:modelValue":r[7]||(r[7]=w=>p.value=w)},null,512),[[$e,p.value]]),r[11]||(r[11]=ee(" Show Y-Axis Minor Split "))]),e("label",null,[Ce(e("input",{type:"checkbox","onUpdate:modelValue":r[8]||(r[8]=w=>j.value=w)},null,512),[[$e,j.value]]),r[12]||(r[12]=ee(" Show X-Axis Split "))])]),o(X,{onClick:q,"bt-type":"button","bt-disabled":!1},{default:_(()=>r[13]||(r[13]=[ee("Dismiss")])),_:1})]),_:1},8,["mod-show","mod-title"]),e("div",{id:`chart${a.spotId}`,style:ne({width:a.gridview?R(g).asideVisible?"680px":"600.5px":"100%"}),class:le(["chartwrap",h.value?"chartwrap-paused":""])},[a.showUis?(C(),A("div",at,[o(X,{onClick:Z,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(V,{icon:"edit"})]),_:1}),o(X,{onClick:Q,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(V,{icon:h.value?"pause":"play"},null,8,["icon"])]),_:1}),$.value.length?(C(),xe(X,{key:0,onClick:E,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(V,{icon:"sliders"})]),_:1})):te("",!0),o(X,{onClick:I,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(V,{icon:"close"})]),_:1})])):te("",!0),o(Ne,{"id-spot":parseInt(a.spotId)},null,8,["id-spot"]),e("h4",{style:ne({textAlign:"center",color:R(g).accentColor})},[e("b",ot,"SPOT: "+Y(a.chartName),1)],4),$.value.length?(C(),A("p",{key:1,style:{"text-align":"center","margin-bottom":"5px"},class:le(R(g).textTheme)}," Displaying data for last "+Y(a.filterTime)+" hour(s) on "+Y(a.filterDate),3)):te("",!0),e("div",{ref_key:"chartRef",ref:d,style:{width:"100%",height:"600px"}},null,512)],14,lt)],64)}}}),nt={class:"cl-filter"},it={key:0,class:"trunk-selector"},rt={style:{width:"500px",display:"flex",padding:"15px","flex-flow":"column"}},ut=["value"],dt={style:{width:"500px",display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem",position:"relative"}},ct={style:{display:"flex","flex-flow":"column","align-items":"center"}},pt={style:{display:"flex","flex-flow":"row wrap","justify-content":"center"}},vt=["onClick"],mt=pe({__name:"ChartLayerView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(J){const B=l(null),y=l(null),$=l(Me().getAllTrunk()),c=u=>new Date(u).toISOString(),g=J,M=l(g.dateFilter),L=l("15"),d=l({legend:{show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",name:"Time",data:[],nameGap:40,boundaryGap:0,nameLocation:"center",axisLabel:{show:!0,rotate:45,interval:u=>a.value[u]===void 0?!1:a.value[u].split(":")[1]%L.value===0},axisSplitLine:{show:!0,lineStyle:{type:"solid"}},axisLine:{show:!0,lineStyle:{type:"solid"}}},yAxis:{type:"value",min:0,max:550,interval:50,minorTick:{show:!0},scale:!0,nameLocation:"center",nameGap:50,boundaryGap:0,splitLine:{show:!0,lineStyle:{type:"solid",color:"#00000055"}},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#00000022"}},axisTick:{show:!0},name:"Pressure (PSI)",axisLine:{show:!0}},series:[]});N(()=>L.value,()=>{d.value.xAxis.axisLabel.interval=u=>a.value[u].split(":")[1]%L.value===0,h()}),N(()=>M.value,()=>{Object.keys(m.value).length>0&&S()});const m=l({}),G=l(),h=()=>{y.value.setOption(d.value)};N(()=>B.value,()=>{y.value=ye(B.value),h()});const P=l({}),a=l([]),U=l(!1),H=()=>{const u=G.value,s=$.value[u].name,b=$.value[u].spot;m.value[s]=b,U.value=!1,P.value={},a.value=[],y.value.clear(),d.value.series=[],y.value.setOption(d.value),S()},S=()=>{Object.keys(m.value).forEach(async u=>{const s=[],b=[];for(let p=0;p<m.value[u].length;p++){const oe={id:m.value[u][p].id+"",date:c(M.value),timespan:g.timeFilter+"",firstrequest:!0},D=await ge().httpPost("api/Data/getsingledata",oe),K=D.map(v=>v.psiValue.toFixed(2));b.push({type:"line",data:K,smooth:!1,symbol:"none",name:m.value[u][p].name});const F=D.map(v=>Pe(v.timestamp).format("HH:mm"));for(let v=0;v<F.length;v++)s.includes(F[v])||s.push(F[v])}P.value[u]=b,a.value=s})};N(()=>P,()=>{y.value.clear(),y.value.setOption(d.value),T()},{deep:!0});const T=()=>{d.value.xAxis.data=a.value,Object.keys(P.value).forEach(u=>{for(let s=0;s<P.value[u].length;s++)d.value.series.push(P.value[u][s])}),y.value.setOption(d.value)},k=u=>{delete m.value[u],S()};return(u,s)=>{const b=he("font-awesome-icon");return C(),A(de,null,[e("div",nt,[U.value?(C(),A("div",it,[e("button",{onClick:s[0]||(s[0]=p=>U.value=!U.value),type:"button",class:"drwclose"},[o(b,{icon:"close"})]),e("div",rt,[s[7]||(s[7]=e("h5",null,[e("b",null,"Trunkline Preference")],-1)),o(ce,{"in-label":"Trunkline",style:{width:"100%"},"model-value":G.value,"onUpdate:modelValue":s[1]||(s[1]=p=>G.value=p)},{default:_(()=>[s[5]||(s[5]=e("option",{selected:"",value:""},"Select Trunkline...",-1)),(C(!0),A(de,null,fe($.value,(p,j)=>(C(),A("option",{key:j,value:j},Y(p.name),9,ut))),128))]),_:1},8,["model-value"]),o(X,{onClick:H,"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content",padding:"13px",width:"170px"}},{default:_(()=>s[6]||(s[6]=[ee("Load into Chart")])),_:1})])])):te("",!0),s[9]||(s[9]=e("h3",null,[e("b",null,"Chart Layer")],-1)),e("div",dt,[o(se,{"in-type":"date","in-label":"Date Filter","model-value":M.value,"onUpdate:modelValue":s[2]||(s[2]=p=>M.value=p)},null,8,["model-value"]),o(ce,{"in-label":"X-Axis Gap",style:{width:"100%"},"model-value":L.value,"onUpdate:modelValue":s[3]||(s[3]=p=>L.value=p)},{default:_(()=>s[8]||(s[8]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),o(X,{onClick:s[4]||(s[4]=p=>U.value=!U.value),"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content","margin-top":"36px",padding:"13px"}},{default:_(()=>[o(b,{icon:"plus"})]),_:1})])]),e("div",{ref_key:"chart",ref:B,style:{width:"100%",height:"480px"}},null,512),s[11]||(s[11]=e("hr",null,null,-1)),e("div",ct,[s[10]||(s[10]=e("label",null,[e("b",null,"Active Trunklines")],-1)),e("div",pt,[(C(!0),A(de,null,fe(m.value,(p,j)=>(C(),A("span",{class:"active-trunklines",key:j,onClick:oe=>k(j),style:{margin:"5px"}},[e("span",null,Y(j),1)],8,vt))),128))])])],64)}}}),ft=Te(mt,[["__scopeId","data-v-a1bd2a50"]]),yt={key:0,class:"chart-layer"},ht={class:"chart-layer-inner"},gt={key:1,class:"live-window"},bt={key:2,class:"live-window"},wt={key:3,class:"drw-wd"},xt={class:"row"},kt={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},St={class:"col-md-12"},Tt={class:"col-md-12"},Ct={style:{display:"flex","flex-flow":"row nowrap",gap:"0.4rem"}},$t={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},_t={class:"spot-reading-control"},Mt={class:"spot-basket"},Dt=["onClick","onDblclick"],It={key:0,style:{"margin-top":"1rem",display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Ht=pe({__name:"MonitoringFol",setup(J){let B=null;try{const i=localStorage.getItem("user");B=i?JSON.parse(i):null}catch(i){console.error("Failed to parse localStorage user:",i)}console.log("Stored user:",JSON.stringify(B,null,2));const y=Ue("https://flipapi.rndkito.com");y.emit("joinField","jbi"),y.on("connect",()=>{console.log("Socket Connected:",y.id)}),y.on("disconnect",()=>{console.log("Disconnected")}),y.on("pressure:new",i=>{if((i==null?void 0:i.field_id)!=="jbi"||h.value)return;const t=Number(i==null?void 0:i.psi);Number.isFinite(t)&&($[i.spot_id]={ts:String(i.timestamp),val:t},console.log("liveFeed updated",i.spot_id,$[i.spot_id]))});const $=Oe({}),c=me();c.asideToggle(!0);const g=l(null),M=l(!1),L=l(350),d=l(0),m=l(30),G=l(3e3),h=l(!1),P=l(""),a=l(!1),U=l(24),H=l(!1),S=l([]),T=l(0),k=()=>{T.value<S.value.length&&setTimeout(()=>{T.value++,k()},100)},u=()=>{const i=new Date,t=i.getFullYear(),x=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),ae=`${t}-${x}-${n}`;P.value=ae},s=()=>{document.visibilityState==="visible"?setTimeout(()=>{h.value=!1,c.notifyShow("Resuming data fetch")},3e3):h.value=!0};Se(()=>{oe(),u(),k(),document.addEventListener("visibilitychange",s)}),be(()=>{document.removeEventListener("visibilitychange",s)});const b=()=>{H.value=!0},p=i=>{H.value=!1,S.value.some(x=>x.id===i.id)?c.notifyShowError("Selected spot already displayed"):S.value.push(i)},j=i=>{S.value=S.value.filter(t=>!t[i])},oe=async()=>{try{const t=(await Ve({field_id:"jbi"})).trunklines.flatMap(x=>x.spots.map(n=>({id:n.spot_id,name:n.spot_name,desc:x.tline_name,safemark:n.safe_mark||0,yMax:n.y_max||500,yInterval:n.y_interval||20})));S.value=t,console.log("spots ",S.value)}catch(i){console.error("Failed to fetch spots:",i)}},z=l(!1),D=()=>{z.value=!z.value},K=()=>{z.value=!1,c.notifyShow("Options has been applied")},F=i=>{const t=document.getElementById("chart"+i);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},v=()=>{M.value=!M.value},O=i=>{S.value=S.value.filter(t=>!t[i])};let I=l([]);const E=i=>{I.value.push({id:i});const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="red",x.style.color="white"):console.warn(`Element dengan class ${t} gak ditemukan bro!`)},q=i=>{const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="#000",x.style.color="#fff"):console.warn(`Element dengan class ${t} gak ditemukan bro!`);const n=I.value.findIndex(ae=>ae.id===i);I.value.splice(n,1)},Q=()=>{h.value=!1},Z=()=>{h.value=!0},ie=async i=>{},re=l(!1),f=i=>{console.log("gg"),h.value=!0,re.value=!0,S.value.length>0?(console.log("masuk1"),r()):console.log("tutup")},r=async i=>{const t=ye(g.value);await ie().then(x=>{const n=x.cats,ae=x.series,we={graphic:[{type:"rect",shape:{x:0,y:0,width:t.getWidth(),height:t.getHeight()},style:{fill:"transparent"}}],backgroundColor:"#fff",tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value",min:0,max:350},series:[{type:"line",data:ae,color:n.map(()=>`${c.accentColor}`)}]};t.setOption(we),t.setOption({yAxis:{name:"Pressure (PSI)"}})})},V=()=>{re.value=!1},w=l(!1),ve=()=>{w.value=!1},ue=l(!1),W=l(!1);return N(()=>W.value,()=>{W.value?h.value=!0:h.value=!1}),N(()=>S.value.length,(i,t)=>{i>t&&T.value<i&&(T.value++,setTimeout(k,0))}),(i,t)=>{const x=he("font-awesome-icon");return C(),A(de,null,[W.value?(C(),A("div",yt,[e("div",ht,[e("button",{onClick:t[0]||(t[0]=n=>W.value=!W.value),type:"button",class:"drwclose"},[o(x,{icon:"close"})]),o(ft,{"date-filter":P.value,"time-filter":U.value},null,8,["date-filter","time-filter"])])])):te("",!0),ue.value?(C(),A("div",gt,[e("div",{class:le(["live-window-inner",[`${R(c).mTheme}`]])},[e("button",{onClick:t[1]||(t[1]=n=>ue.value=!ue.value),type:"button",class:"drwclose"},[o(x,{icon:"close"})]),o(et,{"date-filter":P.value,"time-filter":U.value},null,8,["date-filter","time-filter"])],2)])):te("",!0),w.value?(C(),A("div",bt,[e("div",{class:le(["live-window-inner",[`${R(c).mTheme}`]])},[e("button",{type:"button",class:"drwclose",onClick:ve},[o(x,{icon:"close"})]),o(Ye,{"date-filter":P.value,"time-filter":U.value},null,8,["date-filter","time-filter"])],2)])):te("",!0),re.value?(C(),A("div",wt,[e("div",{class:"drw-inner",style:ne({background:`${R(c).themeDarkColor}`})},[e("button",{onClick:V,type:"button",style:ne({color:`${R(c).accentColor}`}),class:"drwclose"},[o(x,{icon:"close"})],4),e("div",{ref_key:"eCharts",ref:g,style:{width:"100%",height:"100%",position:"relative"}},null,512)],4)])):te("",!0),o(ke,{"mod-show":H.value,"onUpdate:modShow":t[2]||(t[2]=n=>H.value=n),"mod-title":"Select spot"},{default:_(()=>[(C(!0),A(de,null,fe(S.value,(n,ae)=>(C(),xe(Be,{key:ae,onOnItemSelect:p,"item-id":n.id,"item-name":n.name,"item-desc":n.desc,"item-safemark":n.safemark},null,8,["item-id","item-name","item-desc","item-safemark"]))),128))]),_:1},8,["mod-show"]),o(ke,{"mod-show":z.value,"onUpdate:modShow":t[8]||(t[8]=n=>z.value=n),"mod-title":"Global Chart Preference"},{default:_(()=>[e("p",{style:ne({color:R(c).accentColor})},"These parameters applies to all displayed charts",4),o(se,{"in-label":"Y-Axis Max Tick Range","in-type":"number","model-value":L.value,"onUpdate:modelValue":t[3]||(t[3]=n=>L.value=n)},null,8,["model-value"]),o(se,{"in-label":"Y-Axis Min Tick Range","in-type":"number","model-value":d.value,"onUpdate:modelValue":t[4]||(t[4]=n=>d.value=n)},null,8,["model-value"]),o(se,{"in-label":"X-Axis Tick Amount","in-helper":"Greater value produces denser tick rates while lesser value loosen it but trims certain data in some points of time","in-type":"number","model-value":m.value,"onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n)},null,8,["model-value"]),o(se,{"in-label":"Data Update Interval (Milisecond)","in-helper":"Higher value increases the delay while lower value decreases it. Warning: Lower value require more resources and may significantly affect client-side performance","in-type":"number","model-value":G.value,"onUpdate:modelValue":t[6]||(t[6]=n=>G.value=n)},null,8,["model-value"]),o(ce,{"in-label":"Curve Type","model-value":a.value,"onUpdate:modelValue":t[7]||(t[7]=n=>a.value=n)},{default:_(()=>t[14]||(t[14]=[e("option",{value:!0},"Smooth",-1),e("option",{value:!1},"Straight",-1)])),_:1},8,["model-value"]),o(X,{onClick:K,"bt-type":"button","bt-disabled":!1},{default:_(()=>t[15]||(t[15]=[ee("Dismiss")])),_:1})]),_:1},8,["mod-show"]),o(Ae,{"context-title":"Monitoring FOL"},{default:_(()=>[e("div",xt,[e("div",kt,[o(X,{onClick:D,"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(x,{icon:"sliders"}),t[16]||(t[16]=ee(" Global Chart Preferences"))]),_:1})]),e("div",St,[o(se,{"in-type":"date","in-label":"Date Filter","model-value":P.value,"onUpdate:modelValue":t[9]||(t[9]=n=>P.value=n)},null,8,["model-value"]),o(ce,{"in-label":"Time Range Filter","model-value":U.value,"onUpdate:modelValue":t[10]||(t[10]=n=>U.value=n)},{default:_(()=>t[17]||(t[17]=[e("option",{value:"1"},"1 Hour",-1),e("option",{value:"3"},"3 Hours",-1),e("option",{value:"6"},"6 Hours",-1),e("option",{value:"12"},"12 Hours",-1),e("option",{value:"24"},"24 Hours",-1)])),_:1},8,["model-value"]),e("div",Tt,[e("div",Ct,[o(X,{onClick:t[11]||(t[11]=n=>w.value=!w.value),"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[18]||(t[18]=ee(" Live Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[12]||(t[12]=n=>ue.value=!ue.value),"bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[19]||(t[19]=ee(" Trunkline Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[13]||(t[13]=n=>W.value=!W.value),"bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[20]||(t[20]=ee(" Chart Layer "))]),_:1})])]),e("div",$t,[o(X,{onClick:b,"bt-type":"button","bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(x,{icon:"add"}),t[21]||(t[21]=ee(" Add Chart"))]),_:1})]),e("div",_t,[o(X,{onClick:Q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(x,{icon:"play"}),t[22]||(t[22]=ee(" Resume All"))]),_:1}),o(X,{onClick:Z,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(x,{icon:"pause"}),t[23]||(t[23]=ee(" Pause All"))]),_:1})]),e("div",Mt,[(C(!0),A(de,null,fe(S.value,n=>(C(),A("span",{key:n.id,class:le(["spot-data",[`spotdata-${n.id}`]]),onClick:ae=>F(n.id),onDblclick:ae=>j(n.id),title:"Click to navigate to this spot"},Y(n.name)+" ("+Y(n.desc)+") ",43,Dt))),128))]),S.value.length?(C(),A("div",It,[o(X,{onClick:v,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(x,{icon:M.value?"grip-vertical":"expand"},null,8,["icon"]),ee(" "+Y(M.value?"Grid chart view":"Full chart view"),1)]),_:1})])):te("",!0),S.value.length>0?(C(),A("div",{key:1,class:le(M.value?"chart-basket-gridview":"chart-basket-fullview")},[(C(!0),A(de,null,fe(S.value,(n,ae)=>(C(),A("div",{key:n.id,class:"chart-wrapper"},[ae<T.value?(C(),xe(st,{key:0,onOnChartReady:k,id:"chart"+n.id,"chart-name":n.name,"filter-date":P.value,"filter-time":U.value,"safe-mark":n.safemark,"spot-id":n.id,"curve-type":a.value,"y-max":n.yMax,"y-min":d.value,"tick-amount":m.value,"y-interval":n.yInterval,"data-fetch-interval":G.value,gridview:M.value,"is-data-paused":h.value,"live-point":$[n.id],onOnDrawingMode:f,onOnChartClose:O,onOnPause:E,onOnResume:q},null,8,["id","chart-name","filter-date","filter-time","safe-mark","spot-id","curve-type","y-max","y-min","tick-amount","y-interval","data-fetch-interval","gridview","is-data-paused","live-point"])):te("",!0)]))),128))],2)):te("",!0)])])]),_:1})],64)}}});export{Ht as default};
