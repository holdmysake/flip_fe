import{u as ve}from"./theme-BZnJ4Zy7.js";import{d as $e,i as fe}from"./index-B5d4h4Xc.js";import{_ as Le}from"./MainWrapperView.vue_vue_type_style_index_0_lang-D042I6EZ.js";import{_ as ne}from"./InputView.vue_vue_type_style_index_0_lang-Dc87Rz_M.js";import{_ as ce}from"./SelectView.vue_vue_type_style_index_0_lang-0ZxYuFN_.js";import{_ as X}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-Bd3-ELm1.js";import{d as pe,c as O,k as te,e,f as ie,u as R,a as o,r as ye,n as le,t as Y,q as Oe,o as T,l as ee,w as _,g as a,i as F,h as ke,j as ge,_ as Se,F as de,v as Te,x as Ce,b as we,y as me,z as Ne}from"./index-C1_9O8-X.js";import{u as he}from"./http-slHnvWui.js";import{t as _e}from"./trunk-dwr8fwI0.js";import{_ as Fe}from"./BatteryView.vue_vue_type_style_index_0_computed_true_lang-Cx49dl6n.js";import{p as Me}from"./api-CWpVRe9p.js";import{h as Ve}from"./moment-C5S46NFB.js";import{l as Pe}from"./index-TjCxX7sJ.js";const Ue={key:0,class:"mod-overlay"},qe={class:"mod-heading"},Re={class:"mod-body"},xe=pe({__name:"ModalEditorView",props:{modTitle:{type:String,required:!0},modShow:{type:Boolean,default:!0}},emits:["update:modShow"],setup(B,{emit:U}){const h=ve(),y=B,g=U,v=()=>{g("update:modShow",!y.modShow)};return(V,I)=>{const d=ye("font-awesome-icon");return B.modShow?(T(),O("div",Ue,[e("div",{class:le(["mod-content",R(h).mTheme])},[e("button",{onClick:v,type:"button",class:"mod-dismiss",style:ie({color:R(h).accentColor})},[o(d,{icon:"times"})],4),e("div",qe,[e("h4",{class:le(R(h).textTheme)},[e("b",null,Y(B.modTitle),1)],2)]),e("div",Re,[Oe(V.$slots,"default")])],2)])):te("",!0)}}}),ze={class:"itemlist-wrapper"},Ge={class:"itemlist-group"},Be=pe({__name:"ItemList",props:{itemName:{type:String,required:!0},itemDesc:{type:String,required:!0},itemId:{type:[String,Number],required:!0},itemSafemark:{type:Number,default:0,required:!0}},emits:["onItemSelect"],setup(B,{emit:U}){const h=ve(),y=U,g=B,v=()=>{y("onItemSelect",{id:g.itemId,name:g.itemName,desc:g.itemDesc})};return(V,I)=>{const d=ye("font-awesome-icon");return T(),O("div",ze,[e("div",Ge,[e("span",{style:ie({color:R(h).accentColor})},[e("b",null,Y(B.itemName),1)],4),e("span",{style:ie({color:R(h).accentColor})},[o(d,{icon:"map-pin"}),ee(" "+Y(B.itemDesc),1)],4)]),o(X,{onClick:v,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(d,{icon:"plus"})]),_:1})])}}}),je={class:"chart-containers"},He={class:"col-md-4"},Ee={class:"loaderparent"},We=pe({__name:"LiveMonitorChart",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(B){const U=B,h=a(!0),y=a(null),g=a(null),v=ve(),V=a(15),I=a([]),d=a(0),m=a("Building chart..."),A=a("Initializing..."),b=a(0),H=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),l=C=>new Date(C).toISOString(),z=async()=>new Promise(async(C,$)=>{await he().httpGet("api/Spot/getspots").then(u=>{C(u)}).catch(u=>{console.error(u),$(u)})});F(()=>y.value,async()=>{k(),await z().then(C=>{I.value=C})});const k=()=>{if(d.value=5,y.value){const C=fe(y.value);g.value=C,g.value.setOption(H.value)}},j=async()=>new Promise(async(C,$)=>{try{const u=[],s=new Set,w=I.value.length;let c=0;A.value="Setting up...";for(let M=0;M<I.value.length;M++){A.value=`Applying filter for ${I.value[M].spotName}...`;const K={id:I.value[M].id+"",date:l(U.dateFilter),timespan:U.timeFilter+"",firstrequest:h.value},P=await he().httpPost("api/Data/getsingledata",K);for(let W=0;W<P.length;W++)setTimeout(()=>{b.value++},1);const p=P.map(W=>{const Q=W.timestamp.replace(".",":").split("T")[1],[Z,ae]=Q.split(":"),ue=`${Z}:${ae}`;return s.add(ue),ue}),D=P.map(W=>parseFloat(W.psiValue));u.push({psies:D,categories:p}),c+=1;const N=c/w*90;d.value=Math.round(N)}const G=Array.from(s).sort((M,K)=>{const[P,p]=M.split(":").map(Number),[D,N]=K.split(":").map(Number);return P!==D?P-D:p-N}),J=u.map((M,K)=>{const P={};M.categories.forEach((D,N)=>{P[D]=M.psies[N]});const p=G.map(D=>P[D]!==void 0?parseFloat(P[D]):null);return{name:`${I.value[K].spotName}`,type:"line",data:p,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:1},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(D){let N=0;const W=u[D.seriesIndex].psies.length;for(let q=0;q<W;q++)u[D.seriesIndex].psies[q]!==null&&(N=u[D.seriesIndex].psies[q].toFixed(2));return N}}}}),E={backgroundColor:"transparent",legend:{data:J.map(M=>({name:M.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:G,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(M){return M.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${v.accentColor}`,rotate:-45,interval:M=>{const[K,P]=G[M].split(":").map(Number);return P%V.value===0},formatter:function(M){return M}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:J};C(E)}catch(u){console.error(u),$(u)}});return F(()=>I.value,async()=>{await j().then(C=>{g.value.setOption(C),A.value="Drawing series...",d.value=99.99,setTimeout(()=>{d.value=100,b.value=0},2e3)})}),F(()=>V.value,async()=>{d.value=5,A.value="Setting up...",m.value="Options & filter updated. Rebuilding chart with new series...",g.value&&(g.value=null),k(),setTimeout(async()=>{await j().then(C=>{g.value.setOption(C),d.value=99.99,A.value="Drawing series...",setTimeout(()=>{d.value=100,b.value=0},2e3)})},1e3)}),ke(()=>{k()}),ge(()=>{y.value&&$e(y.value)}),(C,$)=>(T(),O("div",je,[e("h3",{style:{padding:"15px"},class:le([`${R(v).textTheme}`])},$[1]||($[1]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",He,[o(ce,{"in-label":"X-Axis Time Split","model-value":V.value,"onUpdate:modelValue":$[0]||($[0]=u=>V.value=u)},{default:_(()=>$[2]||($[2]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:y,style:{width:"100%",position:"relative",height:"90%"}},null,512),d.value!=100?(T(),O("div",{key:0,class:le(["chartloader",[`${R(v).mTheme}`]])},[$[3]||($[3]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:le([`${R(v).textTheme}`])},Y(m.value)+" ("+Y(b.value)+" objects collected)",3),e("span",{style:ie({color:`${R(v).accentColorSecondary}`})},Y(A.value),5),e("div",Ee,[e("span",{style:ie({width:`${d.value}%`,background:`${R(v).accentColor}`}),class:"loaderinner"},null,4)])],2)):te("",!0)]))}}),Xe=Se(We,[["__scopeId","data-v-69f62916"]]),Ye={class:"chart-containers"},Je={class:"col-md-4"},Ke={class:"loaderparent"},Qe=pe({__name:"LiveMonitorSegmentView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(B){const U=_e(),h=B,y=a(!0),g=a(null),v=a(null),V=ve(),I=a(15),d=a([]),m=a(0),A=a("Building chart..."),b=a("Initializing..."),H=a(0),l=a("trunk1"),z=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),k=a({tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:[],scale:!0,boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}}}),j=s=>new Date(s).toISOString(),C=()=>{d.value=U.getTrunk(l.value).spot};F(()=>g.value,()=>{$(),C()});const $=()=>{if(m.value=5,g.value){const s=fe(g.value);v.value=s,v.value.setOption(z.value)}},u=async()=>new Promise(async(s,w)=>{try{const c=[],G=new Set,J=d.value.length;let E=0;b.value="Setting up...";for(let p=0;p<d.value.length;p++){b.value=`Applying filter for ${d.value[p].spotName}...`;const D={id:d.value[p].id+"",date:j(h.dateFilter),timespan:h.timeFilter+"",firstrequest:y.value},N=await he().httpPost("api/Data/getsingledata",D);for(let Z=0;Z<N.length;Z++)setTimeout(()=>{H.value++},1);const W=N.map(Z=>{const ue=Z.timestamp.replace(".",":").split("T")[1],[f,r]=ue.split(":"),L=`${f}:${r}`;return G.add(L),L}),q=N.map(Z=>parseFloat(Z.psiValue));c.push({psies:q,categories:W}),E+=1;const Q=E/J*90;m.value=Math.round(Q)}const M=Array.from(G).sort((p,D)=>{const[N,W]=p.split(":").map(Number),[q,Q]=D.split(":").map(Number);return N!==q?N-q:W-Q}),K=c.map((p,D)=>{const N={};p.categories.forEach((q,Q)=>{N[q]=p.psies[Q]});const W=M.map(q=>N[q]!==void 0?parseFloat(N[q]):null);return{name:`${d.value[D].spotName}`,type:"line",data:W,smooth:!1,sampling:"average",symbol:"none",lineStyle:{width:2},endLabel:{show:!0,fontSize:12,color:"#fff",offset:[-5,0],padding:3,borderRadius:3,textBorderWidth:0,backgroundColor:"inherit",formatter:function(q){let Q=0;const Z=c[q.seriesIndex].psies.length;for(let ae=0;ae<Z;ae++)c[q.seriesIndex].psies[ae]!==null&&(Q=c[q.seriesIndex].psies[ae].toFixed(2));return Q}}}}),P={backgroundColor:"transparent",legend:{data:K.map(p=>({name:p.name,icon:"circle",textStyle:{color:"inherit"}}))},xAxis:{type:"category",data:M,scale:!0,alignTicks:!0,name:"Time",axisPointer:{value:"2016-10-7",snap:!0,label:{show:!0,formatter:function(p){return p.value}},handle:{show:!0}},axisTick:{show:!0,alignWithLabel:!0},axisLabel:{color:`${V.accentColor}`,rotate:-45,interval:p=>{const[D,N]=M[p].split(":").map(Number);return N%I.value===0},formatter:function(p){return p}},boundaryGap:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},yAxis:{type:"value",axisTick:{show:!0},axisLine:{show:!0},scale:!0,splitLine:{show:!0,lineStyle:{color:"#55555555"}}},series:K};s(P)}catch(c){console.error(c),w(c)}});return F(()=>d.value,async()=>{await u().then(s=>{v.value.setOption(s),b.value="Drawing series...",m.value=99.99,setTimeout(()=>{m.value=100,H.value=0},2e3)})}),F(()=>I.value,async()=>{m.value=5,b.value="Setting up...",A.value="Options & filter updated. Rebuilding chart with new series...",v.value&&(v.value=null),$(),setTimeout(async()=>{await u().then(s=>{v.value.setOption(s),m.value=99.99,b.value="Drawing series...",setTimeout(()=>{m.value=100,H.value=0},2e3)})},1e3)}),ke(()=>{$()}),ge(()=>{g.value&&$e(g.value)}),F(()=>l.value,()=>{d.value=U.getTrunk(l.value).spot,v.value.clear(),v.value.setOption(k),$()}),(s,w)=>(T(),O("div",Ye,[e("h3",{style:{padding:"15px"},class:le([`${R(V).textTheme}`])},w[2]||(w[2]=[e("b",null,"Live Monitor Chart",-1)]),2),e("div",Je,[o(ce,{"in-label":"Select Spot","model-value":l.value,"onUpdate:modelValue":w[0]||(w[0]=c=>l.value=c)},{default:_(()=>w[3]||(w[3]=[e("option",{value:"trunk1"},"MGS BJG - BOOSTER",-1),e("option",{value:"trunk2"},"MGS KAS - MOS SPPP",-1),e("option",{value:"trunk3"},"SGL LINE",-1),e("option",{value:"trunk4"},"BETUNG - BAJUBANG",-1)])),_:1},8,["model-value"]),o(ce,{"in-label":"X-Axis Time Split","model-value":I.value,"onUpdate:modelValue":w[1]||(w[1]=c=>I.value=c)},{default:_(()=>w[4]||(w[4]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"])]),e("div",{ref_key:"chart",ref:g,style:{width:"100%",position:"relative",height:"100%"}},null,512),m.value!=100?(T(),O("div",{key:0,class:le(["chartloader",[`${R(V).mTheme}`]])},[w[5]||(w[5]=e("img",{style:{"border-radius":"1000px"},src:"https://digitalsynopsis.com/wp-content/uploads/2016/06/loading-animations-preloader-gifs-ui-ux-effects-10.gif"},null,-1)),e("span",{class:le([`${R(V).textTheme}`])},Y(A.value)+" ("+Y(H.value)+" objects collected)",3),e("span",{style:ie({color:`${R(V).accentColorSecondary}`})},Y(b.value),5),e("div",Ke,[e("span",{style:ie({width:`${m.value}%`,background:`${R(V).accentColor}`}),class:"loaderinner"},null,4)])],2)):te("",!0)]))}}),Ze=Se(Qe,[["__scopeId","data-v-40464d3f"]]),et=async B=>(await Me("/fe/getAllSpots",B,!0)).data,tt=async B=>(await Me("/fe/getDataBySpot",B,!0)).data,lt={style:{display:"flex","flex-flow":"column","margin-bottom":"1rem"}},at=["id"],ot={key:0,style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end",gap:"0.5rem","margin-bottom":"1.5rem"}},st={contenteditable:"true",spellcheck:"false"},nt=pe({__name:"ChartView2",props:{filterDate:{type:String,required:!0},filterTime:{type:Number,required:!0},spotId:{type:String,required:!0},chartName:{type:String,required:!0},yMax:{type:Number,required:!0,default:350},yMin:{type:Number,required:!0,default:0},gridview:{type:Boolean,default:!1},tickAmount:{type:Number,default:100},dataFetchInterval:{type:Number,default:1e4},curveType:{type:Boolean,default:!1},safeMark:{type:Number,default:0},isDataPaused:Boolean,showUis:{type:Boolean,default:!0},yInterval:{type:Number,default:0},livePoint:{type:Object,required:!1}},emits:["onChartClose","onChartReady","onPause","onResume","onDrawingMode"],setup(B,{emit:U}){const h=a([]),y=a([]),g=U,v=ve(),V=a(!1),I=a(!0),d=a(null),m=a(null),A=a(!1),b=a(!1);let H;const l=B,z=a(l.safeMark),k=a(!1),j=a(l.yMax),C=a(l.yMin),$=a(l.tickAmount),u=a(50),s=a(l.dataFetchInterval),w=a(l.curveType),c=a(!0),G=a(!0);function J(f,r){return{tooltip:{show:!0,trigger:"item",axisPointer:{type:"cross",axis:"auto",label:{show:!0}}},xAxis:[{type:"category",interval:$.value,axisLine:{show:!0,lineStyle:{color:v.accentColor}},splitLine:{show:G,lineStyle:{color:"#ddd",type:"dashed"}},axisTick:{show:!0},boundaryGap:!1,axisLabel:{rotate:45},data:[]}],yAxis:[{type:"value",min:0,max:f,minorTick:{show:!0},axisTick:{show:!0},minorSplitLine:{show:c,lineStyle:{color:"#ddd",type:"dashed"}},interval:l.yInterval,axisLine:{show:!0,lineStyle:{color:v.accentColor}}}],series:[{name:"PSI Data",type:"line",symbol:"none",data:[],smooth:l.curveType,lineStyle:{width:1.2,join:"miter",miterLimit:3,cap:"round"},tooltip:{position:["50%","50%"]},endLabel:{show:!0,distance:0,color:"black",backgroundColor:"white",padding:5,borderRadius:5}},{name:"Safe Mark",type:"line",tooltip:{trigger:"item"},lineStyle:{color:"red",type:"solid"},markLine:{symbol:"none",label:{show:!1},lineStyle:{color:"red",type:"dashed"},data:[{yAxis:z.value}]}}]}}F(()=>z.value,()=>{var f;E.value.series[1].markLine.data[0].yAxis=z.value,(f=m.value)==null||f.setOption(E.value)});const E=a(J(l.yMax,l.curveType));F(()=>[j.value,C.value,$.value,s.value,w.value,u.value,c.value,G.value],()=>{m.value.setOption(E.value)});const M=()=>{var f;!m.value&&d.value&&(m.value=fe(d.value)),(f=m.value)==null||f.setOption(E.value)},K=f=>new Date(f).toISOString(),P=async()=>{var f;try{const r=typeof K=="function"?K(l.filterDate):new Date(l.filterDate).toISOString(),L=await tt({field_id:"jbi",spot_id:l.spotId,timestamp:r}),S=Array.isArray(L==null?void 0:L.data)?L.data:Array.isArray(L)?L:[],re=S.map(i=>{const t=String(i.timestamp??""),x=t.replace(".",":");if(x.includes("T")){const De=x.split("T")[1]||"",[Ie="00",Ae="00"]=De.split(":");return`${Ie}:${Ae}`}const n=new Date(t||r),oe=String(n.getHours()).padStart(2,"0"),be=String(n.getMinutes()).padStart(2,"0");return`${oe}:${be}`}),se=S.map(i=>{const t=Number(i.psiValue??i.psi??i.value);return isFinite(t)?t:NaN}).map(i=>Number(isFinite(i)?i.toFixed(2):"NaN"));h.value=re,y.value=se,se.length&&se.some(i=>isFinite(i))?(A.value=!1,E.value.xAxis[0].data=re,E.value.series[0].data=se,(f=m.value)==null||f.setOption(E.value)):(A.value=!0,I.value=!1)}catch(r){console.error(r)}};F(()=>d.value,()=>{d.value&&M()}),F(()=>l.gridview,()=>{m.value&&setTimeout(()=>{var f;(f=m.value)==null||f.resize()},500)}),F(()=>l.dataFetchInterval,()=>{s.value=l.dataFetchInterval}),F(()=>[d.value],()=>{P()}),ge(()=>{clearInterval(H)});let p=null;F(()=>[l.filterDate,l.filterTime,l.yMax,l.yMin,l.tickAmount,l.curveType],()=>{p&&clearTimeout(p),p=setTimeout(()=>{j.value=l.yMax,C.value=l.yMin,$.value=l.tickAmount,w.value=l.curveType,s.value=l.dataFetchInterval,E.value=J(l.yMax,l.curveType),I.value=!0,V.value=!1},300)});let D=null;F(()=>[j.value,C.value,$.value,s.value,w.value],()=>{D&&clearTimeout(D),D=setTimeout(()=>{P()},500)}),v.$subscribe((f,r)=>{setTimeout(()=>{P()},2e3)});const N=()=>{g("onChartClose",l.spotId)},W=()=>{k.value=!k.value},q=()=>{k.value=!1},Q=()=>{b.value=!b.value,b.value?g("onPause",l.spotId):g("onResume",l.spotId)};F(()=>[l.isDataPaused],()=>{b.value=l.isDataPaused,b.value?g("onPause",l.spotId):g("onResume",l.spotId)}),F(()=>b.value,()=>{b.value?g("onPause",l.spotId):g("onResume",l.spotId)}),F(()=>v.asideVisible,()=>{m.value&&setTimeout(()=>{var f;(f=m.value)==null||f.resize()},500)});const Z=()=>{g("onDrawingMode",l.spotId)},ae=f=>{const r=f.includes("T")?f:f.replace(" ","T"),L=new Date(r),S=String(L.getHours()).padStart(2,"0"),re=String(L.getMinutes()).padStart(2,"0");return`${S}:${re}`},ue=f=>{if(!h.value.length)return!0;const r=h.value[h.value.length-1],L=new Date((l.filterDate+" "+r).replace(" ","T"));return new Date(f.includes("T")?f:f.replace(" ","T")).getTime()>L.getTime()};return F(()=>l.livePoint,f=>{var S;if(!f||b.value)return;const r=Number(f.val);if(!Number.isFinite(r))return;const L=ae(f.ts);if(h.value.length&&h.value[h.value.length-1]===L)y.value[y.value.length-1]=Number(r.toFixed(2));else{if(!ue(f.ts))return;h.value.push(L),y.value.push(Number(r.toFixed(2)))}A.value=!1,E.value.xAxis[0].data=h.value,E.value.series[0].data=y.value,(S=m.value)==null||S.setOption({xAxis:[{data:h.value}],series:[{data:y.value},{}]})}),(f,r)=>{const L=ye("font-awesome-icon");return T(),O(de,null,[o(xe,{"mod-show":k.value,"onUpdate:modShow":r[9]||(r[9]=S=>k.value=S),"mod-title":`${l.chartName} Preferences`},{default:_(()=>[o(ne,{"in-type":"number","in-label":"Safemark","model-value":z.value,"onUpdate:modelValue":r[0]||(r[0]=S=>z.value=S)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Max Tick","model-value":j.value,"onUpdate:modelValue":r[1]||(r[1]=S=>j.value=S)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Min Tick","model-value":C.value,"onUpdate:modelValue":r[2]||(r[2]=S=>C.value=S)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Y-Axis Interval","model-value":u.value,"onUpdate:modelValue":r[3]||(r[3]=S=>u.value=S)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"X-Axis Tick Amount","model-value":$.value,"onUpdate:modelValue":r[4]||(r[4]=S=>$.value=S)},null,8,["model-value"]),o(ne,{"in-type":"number","in-label":"Data Update Interval (Milisecond)","model-value":s.value,"onUpdate:modelValue":r[5]||(r[5]=S=>s.value=S)},null,8,["model-value"]),o(ce,{"in-label":"Curve Type","model-value":w.value,"onUpdate:modelValue":r[6]||(r[6]=S=>w.value=S)},{default:_(()=>r[10]||(r[10]=[e("option",{value:"true"},"Smooth",-1),e("option",{value:"false"},"Straight",-1)])),_:1},8,["model-value"]),e("div",lt,[e("label",null,[Te(e("input",{type:"checkbox","onUpdate:modelValue":r[7]||(r[7]=S=>c.value=S)},null,512),[[Ce,c.value]]),r[11]||(r[11]=ee(" Show Y-Axis Minor Split "))]),e("label",null,[Te(e("input",{type:"checkbox","onUpdate:modelValue":r[8]||(r[8]=S=>G.value=S)},null,512),[[Ce,G.value]]),r[12]||(r[12]=ee(" Show X-Axis Split "))])]),o(X,{onClick:q,"bt-type":"button","bt-disabled":!1},{default:_(()=>r[13]||(r[13]=[ee("Dismiss")])),_:1})]),_:1},8,["mod-show","mod-title"]),e("div",{id:`chart${l.spotId}`,style:ie({width:l.gridview?R(v).asideVisible?"680px":"600.5px":"100%"}),class:le(["chartwrap",b.value?"chartwrap-paused":""])},[l.showUis?(T(),O("div",ot,[o(X,{onClick:Z,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(L,{icon:"edit"})]),_:1}),o(X,{onClick:Q,"bt-type":"button","bt-size":"small","bt-disabled":!1},{default:_(()=>[o(L,{icon:b.value?"pause":"play"},null,8,["icon"])]),_:1}),y.value.length?(T(),we(X,{key:0,onClick:W,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(L,{icon:"sliders"})]),_:1})):te("",!0),o(X,{onClick:N,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(L,{icon:"close"})]),_:1})])):te("",!0),o(Fe,{"id-spot":parseInt(l.spotId)},null,8,["id-spot"]),e("h4",{style:ie({textAlign:"center",color:R(v).accentColor})},[e("b",st,"SPOT: "+Y(l.chartName),1)],4),y.value.length?(T(),O("p",{key:1,style:{"text-align":"center","margin-bottom":"5px"},class:le(R(v).textTheme)}," Displaying data for last "+Y(l.filterTime)+" hour(s) on "+Y(l.filterDate),3)):te("",!0),e("div",{ref_key:"chartRef",ref:d,style:{width:"100%",height:"600px"}},null,512)],14,at)],64)}}}),it={class:"cl-filter"},rt={key:0,class:"trunk-selector"},ut={style:{width:"500px",display:"flex",padding:"15px","flex-flow":"column"}},dt=["value"],ct={style:{width:"500px",display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"0.5rem",position:"relative"}},pt={style:{display:"flex","flex-flow":"column","align-items":"center"}},vt={style:{display:"flex","flex-flow":"row wrap","justify-content":"center"}},mt=["onClick"],ft=pe({__name:"ChartLayerView",props:{dateFilter:{type:String,required:!0},timeFilter:{type:Number,required:!0}},setup(B){const U=a(null),h=a(null),y=a(_e().getAllTrunk()),g=u=>new Date(u).toISOString(),v=B,V=a(v.dateFilter),I=a("15"),d=a({legend:{show:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",name:"Time",data:[],nameGap:40,boundaryGap:0,nameLocation:"center",axisLabel:{show:!0,rotate:45,interval:u=>l.value[u]===void 0?!1:l.value[u].split(":")[1]%I.value===0},axisSplitLine:{show:!0,lineStyle:{type:"solid"}},axisLine:{show:!0,lineStyle:{type:"solid"}}},yAxis:{type:"value",min:0,max:550,interval:50,minorTick:{show:!0},scale:!0,nameLocation:"center",nameGap:50,boundaryGap:0,splitLine:{show:!0,lineStyle:{type:"solid",color:"#00000055"}},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#00000022"}},axisTick:{show:!0},name:"Pressure (PSI)",axisLine:{show:!0}},series:[]});F(()=>I.value,()=>{d.value.xAxis.axisLabel.interval=u=>l.value[u].split(":")[1]%I.value===0,b()}),F(()=>V.value,()=>{Object.keys(m.value).length>0&&j()});const m=a({}),A=a(),b=()=>{h.value.setOption(d.value)};F(()=>U.value,()=>{h.value=fe(U.value),b()});const H=a({}),l=a([]),z=a(!1),k=()=>{const u=A.value,s=y.value[u].name,w=y.value[u].spot;m.value[s]=w,z.value=!1,H.value={},l.value=[],h.value.clear(),d.value.series=[],h.value.setOption(d.value),j()},j=()=>{Object.keys(m.value).forEach(async u=>{const s=[],w=[];for(let c=0;c<m.value[u].length;c++){const J={id:m.value[u][c].id+"",date:g(V.value),timespan:v.timeFilter+"",firstrequest:!0},M=await he().httpPost("api/Data/getsingledata",J),K=M.map(p=>p.psiValue.toFixed(2));w.push({type:"line",data:K,smooth:!1,symbol:"none",name:m.value[u][c].name});const P=M.map(p=>Ve(p.timestamp).format("HH:mm"));for(let p=0;p<P.length;p++)s.includes(P[p])||s.push(P[p])}H.value[u]=w,l.value=s})};F(()=>H,()=>{h.value.clear(),h.value.setOption(d.value),C()},{deep:!0});const C=()=>{d.value.xAxis.data=l.value,Object.keys(H.value).forEach(u=>{for(let s=0;s<H.value[u].length;s++)d.value.series.push(H.value[u][s])}),h.value.setOption(d.value)},$=u=>{delete m.value[u],j()};return(u,s)=>{const w=ye("font-awesome-icon");return T(),O(de,null,[e("div",it,[z.value?(T(),O("div",rt,[e("button",{onClick:s[0]||(s[0]=c=>z.value=!z.value),type:"button",class:"drwclose"},[o(w,{icon:"close"})]),e("div",ut,[s[7]||(s[7]=e("h5",null,[e("b",null,"Trunkline Preference")],-1)),o(ce,{"in-label":"Trunkline",style:{width:"100%"},"model-value":A.value,"onUpdate:modelValue":s[1]||(s[1]=c=>A.value=c)},{default:_(()=>[s[5]||(s[5]=e("option",{selected:"",value:""},"Select Trunkline...",-1)),(T(!0),O(de,null,me(y.value,(c,G)=>(T(),O("option",{key:G,value:G},Y(c.name),9,dt))),128))]),_:1},8,["model-value"]),o(X,{onClick:k,"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content",padding:"13px",width:"170px"}},{default:_(()=>s[6]||(s[6]=[ee("Load into Chart")])),_:1})])])):te("",!0),s[9]||(s[9]=e("h3",null,[e("b",null,"Chart Layer")],-1)),e("div",ct,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":V.value,"onUpdate:modelValue":s[2]||(s[2]=c=>V.value=c)},null,8,["model-value"]),o(ce,{"in-label":"X-Axis Gap",style:{width:"100%"},"model-value":I.value,"onUpdate:modelValue":s[3]||(s[3]=c=>I.value=c)},{default:_(()=>s[8]||(s[8]=[e("option",{value:"5"},"5 Minutes",-1),e("option",{value:"10"},"10 Minutes",-1),e("option",{value:"15"},"15 Minutes",-1),e("option",{value:"30"},"30 Minutes",-1),e("option",{value:"45"},"45 Minutes",-1),e("option",{value:"60"},"1 Hour",-1)])),_:1},8,["model-value"]),o(X,{onClick:s[4]||(s[4]=c=>z.value=!z.value),"bt-disabled":!1,"bt-size":"small",style:{height:"fit-content","margin-top":"36px",padding:"13px"}},{default:_(()=>[o(w,{icon:"plus"})]),_:1})])]),e("div",{ref_key:"chart",ref:U,style:{width:"100%",height:"480px"}},null,512),s[11]||(s[11]=e("hr",null,null,-1)),e("div",pt,[s[10]||(s[10]=e("label",null,[e("b",null,"Active Trunklines")],-1)),e("div",vt,[(T(!0),O(de,null,me(m.value,(c,G)=>(T(),O("span",{class:"active-trunklines",key:G,onClick:J=>$(G),style:{margin:"5px"}},[e("span",null,Y(G),1)],8,mt))),128))])])],64)}}}),yt=Se(ft,[["__scopeId","data-v-a1bd2a50"]]),ht={key:0,class:"chart-layer"},gt={class:"chart-layer-inner"},bt={key:1,class:"live-window"},wt={key:2,class:"live-window"},xt={key:3,class:"drw-wd"},kt={class:"row"},St={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Tt={class:"col-md-12"},Ct={class:"col-md-12"},$t={style:{display:"flex","flex-flow":"row nowrap",gap:"0.4rem"}},_t={style:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Mt={class:"spot-reading-control"},Dt={class:"spot-basket"},It=["onClick","onDblclick"],At={key:0,style:{"margin-top":"1rem",display:"flex","flex-flow":"row nowrap","justify-content":"flex-end"}},Ht=pe({__name:"MonitoringFol",setup(B){const U=Pe("https://flipapi.rndkito.com");U.emit("joinField","jbi"),U.on("connect",()=>{console.log("Socket Connected:",U.id)}),U.on("disconnect",()=>{console.log("Disconnected")}),U.on("pressure:new",i=>{if((i==null?void 0:i.field_id)!=="jbi"||A.value)return;const t=Number(i==null?void 0:i.psi);Number.isFinite(t)&&(h[i.spot_id]={ts:String(i.timestamp),val:t},console.log("liveFeed updated",i.spot_id,h[i.spot_id]))});const h=Ne({}),y=ve();y.asideToggle(!0);const g=a(null),v=a(!1),V=a(350),I=a(0),d=a(30),m=a(3e3),A=a(!1),b=a(""),H=a(!1),l=a(24),z=a(!1),k=a([]),j=a(0),C=()=>{j.value<k.value.length&&setTimeout(()=>{j.value++,C()},100)},$=()=>{const i=new Date,t=i.getFullYear(),x=String(i.getMonth()+1).padStart(2,"0"),n=String(i.getDate()).padStart(2,"0"),oe=`${t}-${x}-${n}`;b.value=oe},u=()=>{document.visibilityState==="visible"?setTimeout(()=>{A.value=!1,y.notifyShow("Resuming data fetch")},3e3):A.value=!0};ke(()=>{G(),$(),C(),document.addEventListener("visibilitychange",u)}),ge(()=>{document.removeEventListener("visibilitychange",u)});const s=()=>{z.value=!0},w=i=>{z.value=!1,k.value.some(x=>x.id===i.id)?y.notifyShowError("Selected spot already displayed"):k.value.push(i)},c=i=>{k.value=k.value.filter(t=>!t[i])},G=async()=>{try{const t=(await et({field_id:"jbi"})).trunklines.flatMap(x=>x.spots.map(n=>({id:n.spot_id,name:n.spot_name,desc:x.tline_name,safemark:n.safe_mark||0,yMax:n.y_max||500,yInterval:n.y_interval||20})));k.value=t,console.log("spots ",k.value)}catch(i){console.error("Failed to fetch spots:",i)}},J=a(!1),E=()=>{J.value=!J.value},M=()=>{J.value=!1,y.notifyShow("Options has been applied")},K=i=>{const t=document.getElementById("chart"+i);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},P=()=>{v.value=!v.value},p=i=>{k.value=k.value.filter(t=>!t[i])};let D=a([]);const N=i=>{D.value.push({id:i});const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="red",x.style.color="white"):console.warn(`Element dengan class ${t} gak ditemukan bro!`)},W=i=>{const t=`spotdata-${i}`,x=document.querySelector(`.${t}`);x?(x.style.background="#000",x.style.color="#fff"):console.warn(`Element dengan class ${t} gak ditemukan bro!`);const n=D.value.findIndex(oe=>oe.id===i);D.value.splice(n,1)},q=()=>{A.value=!1},Q=()=>{A.value=!0},Z=async i=>{},ae=a(!1),ue=i=>{console.log("gg"),A.value=!0,ae.value=!0,k.value.length>0?(console.log("masuk1"),f()):console.log("tutup")},f=async i=>{const t=fe(g.value);await Z().then(x=>{const n=x.cats,oe=x.series,be={graphic:[{type:"rect",shape:{x:0,y:0,width:t.getWidth(),height:t.getHeight()},style:{fill:"transparent"}}],backgroundColor:"#fff",tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value",min:0,max:350},series:[{type:"line",data:oe,color:n.map(()=>`${y.accentColor}`)}]};t.setOption(be),t.setOption({yAxis:{name:"Pressure (PSI)"}})})},r=()=>{ae.value=!1},L=a(!1),S=()=>{L.value=!1},re=a(!1),se=a(!1);return F(()=>se.value,()=>{se.value?A.value=!0:A.value=!1}),F(()=>k.value.length,(i,t)=>{i>t&&j.value<i&&(j.value++,setTimeout(C,0))}),(i,t)=>{const x=ye("font-awesome-icon");return T(),O(de,null,[se.value?(T(),O("div",ht,[e("div",gt,[e("button",{onClick:t[0]||(t[0]=n=>se.value=!se.value),type:"button",class:"drwclose"},[o(x,{icon:"close"})]),o(yt,{"date-filter":b.value,"time-filter":l.value},null,8,["date-filter","time-filter"])])])):te("",!0),re.value?(T(),O("div",bt,[e("div",{class:le(["live-window-inner",[`${R(y).mTheme}`]])},[e("button",{onClick:t[1]||(t[1]=n=>re.value=!re.value),type:"button",class:"drwclose"},[o(x,{icon:"close"})]),o(Ze,{"date-filter":b.value,"time-filter":l.value},null,8,["date-filter","time-filter"])],2)])):te("",!0),L.value?(T(),O("div",wt,[e("div",{class:le(["live-window-inner",[`${R(y).mTheme}`]])},[e("button",{type:"button",class:"drwclose",onClick:S},[o(x,{icon:"close"})]),o(Xe,{"date-filter":b.value,"time-filter":l.value},null,8,["date-filter","time-filter"])],2)])):te("",!0),ae.value?(T(),O("div",xt,[e("div",{class:"drw-inner",style:ie({background:`${R(y).themeDarkColor}`})},[e("button",{onClick:r,type:"button",style:ie({color:`${R(y).accentColor}`}),class:"drwclose"},[o(x,{icon:"close"})],4),e("div",{ref_key:"eCharts",ref:g,style:{width:"100%",height:"100%",position:"relative"}},null,512)],4)])):te("",!0),o(xe,{"mod-show":z.value,"onUpdate:modShow":t[2]||(t[2]=n=>z.value=n),"mod-title":"Select spot"},{default:_(()=>[(T(!0),O(de,null,me(k.value,(n,oe)=>(T(),we(Be,{key:oe,onOnItemSelect:w,"item-id":n.id,"item-name":n.name,"item-desc":n.desc,"item-safemark":n.safemark},null,8,["item-id","item-name","item-desc","item-safemark"]))),128))]),_:1},8,["mod-show"]),o(xe,{"mod-show":J.value,"onUpdate:modShow":t[8]||(t[8]=n=>J.value=n),"mod-title":"Global Chart Preference"},{default:_(()=>[e("p",{style:ie({color:R(y).accentColor})},"These parameters applies to all displayed charts",4),o(ne,{"in-label":"Y-Axis Max Tick Range","in-type":"number","model-value":V.value,"onUpdate:modelValue":t[3]||(t[3]=n=>V.value=n)},null,8,["model-value"]),o(ne,{"in-label":"Y-Axis Min Tick Range","in-type":"number","model-value":I.value,"onUpdate:modelValue":t[4]||(t[4]=n=>I.value=n)},null,8,["model-value"]),o(ne,{"in-label":"X-Axis Tick Amount","in-helper":"Greater value produces denser tick rates while lesser value loosen it but trims certain data in some points of time","in-type":"number","model-value":d.value,"onUpdate:modelValue":t[5]||(t[5]=n=>d.value=n)},null,8,["model-value"]),o(ne,{"in-label":"Data Update Interval (Milisecond)","in-helper":"Higher value increases the delay while lower value decreases it. Warning: Lower value require more resources and may significantly affect client-side performance","in-type":"number","model-value":m.value,"onUpdate:modelValue":t[6]||(t[6]=n=>m.value=n)},null,8,["model-value"]),o(ce,{"in-label":"Curve Type","model-value":H.value,"onUpdate:modelValue":t[7]||(t[7]=n=>H.value=n)},{default:_(()=>t[14]||(t[14]=[e("option",{value:!0},"Smooth",-1),e("option",{value:!1},"Straight",-1)])),_:1},8,["model-value"]),o(X,{onClick:M,"bt-type":"button","bt-disabled":!1},{default:_(()=>t[15]||(t[15]=[ee("Dismiss")])),_:1})]),_:1},8,["mod-show"]),o(Le,{"context-title":"Monitoring FOL"},{default:_(()=>[e("div",kt,[e("div",St,[o(X,{onClick:E,"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(x,{icon:"sliders"}),t[16]||(t[16]=ee(" Global Chart Preferences"))]),_:1})]),e("div",Tt,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":b.value,"onUpdate:modelValue":t[9]||(t[9]=n=>b.value=n)},null,8,["model-value"]),o(ce,{"in-label":"Time Range Filter","model-value":l.value,"onUpdate:modelValue":t[10]||(t[10]=n=>l.value=n)},{default:_(()=>t[17]||(t[17]=[e("option",{value:"1"},"1 Hour",-1),e("option",{value:"3"},"3 Hours",-1),e("option",{value:"6"},"6 Hours",-1),e("option",{value:"12"},"12 Hours",-1),e("option",{value:"24"},"24 Hours",-1)])),_:1},8,["model-value"]),e("div",Ct,[e("div",$t,[o(X,{onClick:t[11]||(t[11]=n=>L.value=!L.value),"bt-size":"small","bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[18]||(t[18]=ee(" Live Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[12]||(t[12]=n=>re.value=!re.value),"bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[19]||(t[19]=ee(" Trunkline Monitor "))]),_:1}),o(X,{"bt-size":"small",onClick:t[13]||(t[13]=n=>se.value=!se.value),"bt-disabled":!1},{default:_(()=>[o(x,{icon:"chart-line"}),t[20]||(t[20]=ee(" Chart Layer "))]),_:1})])]),e("div",_t,[o(X,{onClick:s,"bt-type":"button","bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(x,{icon:"add"}),t[21]||(t[21]=ee(" Add Chart"))]),_:1})]),e("div",Mt,[o(X,{onClick:q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(x,{icon:"play"}),t[22]||(t[22]=ee(" Resume All"))]),_:1}),o(X,{onClick:Q,"bt-disabled":!1,"bt-type":"button","bt-size":"small"},{default:_(()=>[o(x,{icon:"pause"}),t[23]||(t[23]=ee(" Pause All"))]),_:1})]),e("div",Dt,[(T(!0),O(de,null,me(k.value,n=>(T(),O("span",{key:n.id,class:le(["spot-data",[`spotdata-${n.id}`]]),onClick:oe=>K(n.id),onDblclick:oe=>c(n.id),title:"Click to navigate to this spot"},Y(n.name)+" ("+Y(n.desc)+") ",43,It))),128))]),k.value.length?(T(),O("div",At,[o(X,{onClick:P,"bt-disabled":!1,"bt-size":"small"},{default:_(()=>[o(x,{icon:v.value?"grip-vertical":"expand"},null,8,["icon"]),ee(" "+Y(v.value?"Grid chart view":"Full chart view"),1)]),_:1})])):te("",!0),k.value.length>0?(T(),O("div",{key:1,class:le(v.value?"chart-basket-gridview":"chart-basket-fullview")},[(T(!0),O(de,null,me(k.value,(n,oe)=>(T(),O("div",{key:n.id,class:"chart-wrapper"},[oe<j.value?(T(),we(nt,{key:0,onOnChartReady:C,id:"chart"+n.id,"chart-name":n.name,"filter-date":b.value,"filter-time":l.value,"safe-mark":n.safemark,"spot-id":n.id,"curve-type":H.value,"y-max":n.yMax,"y-min":I.value,"tick-amount":d.value,"y-interval":n.yInterval,"data-fetch-interval":m.value,gridview:v.value,"is-data-paused":A.value,"live-point":h[n.id],onOnDrawingMode:ue,onOnChartClose:p,onOnPause:N,onOnResume:W},null,8,["id","chart-name","filter-date","filter-time","safe-mark","spot-id","curve-type","y-max","y-min","tick-amount","y-interval","data-fetch-interval","gridview","is-data-paused","live-point"])):te("",!0)]))),128))],2)):te("",!0)])])]),_:1})],64)}}});export{Ht as default};
